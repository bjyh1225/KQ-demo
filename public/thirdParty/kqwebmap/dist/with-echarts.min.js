window.flowEchartsIndex=0,function(a,b){"function"==typeof define&&define.amd?define(["leaflet"],a):"object"==typeof exports&&(module.exports=a(require("leaflet")),module.exports=a(require("jquery"))),"undefined"!=typeof b&&b.L&&(b.L.flowEcharts=a(L))}(function(a){return a.FlowEcharts=(a.version<"1.0"?a.Class:a.Layer).extend({includes:a.version<"1.0"?a.Mixin.Events:[],_echartsContainer:null,_map:null,_ec:null,_option:null,_echartsOption:null,initialize:function(a,b){this._option=b,this._echartsOption=a},onAdd:function(a){this._map=a,this._initEchartsContainer(),a.on("movestart",this._onMoveStart,this),a.on("moveend",this._redraw,this),this._redraw()},onRemove:function(a){this._echartsContainer&&a.getPanes().overlayPane.removeChild(this._echartsContainer),a.off("movestart",this._onMoveStart,this),a.off("moveend",this._redraw,this)},addTo:function(a){return a.addLayer(this),this},_initEchartsContainer:function(){this._echartsContainer&&this._map.getPanes().overlayPane.removeChild(this._echartsContainer);var a=this._map.getSize(),b=document.createElement("div");b.style.position="absolute",b.style.height=a.y+"px",b.style.width=a.x+"px",b.style.zIndex=flowEchartsIndex--,this._echartsContainer=b,this._map.getPanes().overlayPane.appendChild(this._echartsContainer)},_resetCanvasPosition:function(){var b=this._map.containerPointToLayerPoint([0,0]);a.DomUtil.setPosition(this._echartsContainer,b)},_redraw:function(){return this._resetCanvasPosition(),this._echartsContainer.style.opacity=1,this.initECharts(),this.setOption(this._echartsOption),this},_onMoveStart:function(){this._echartsContainer.style.opacity=.01},clear:function(){this._echartsContainer.innerHTML="",this.echartsOption={}},redraw:function(){this._redraw()},geoCoord2Pixel:function(b){var c=new a.latLng(b[1],b[0]),d=this._map.latLngToContainerPoint(c);return[d.x,d.y]},pixel2GeoCoord:function(b){var c=this._map.containerPointToLatLng(a.point(b[0],b[1]));return[c.lng,c.lat]},initECharts:function(){if(this._ec=echarts.init(this._echartsContainer),echarts.version>="3.0"){var b=this;b._ec.Geo.prototype.dataToPoint=function(c){var d=new a.latLng(c[1],c[0]),e=b._map.latLngToContainerPoint(d);return[e.x,e.y]}}this._unbindEvent()},setOption:function(a,b){if(a.series){var c=a.series||{},d={},e=!1;if(echarts.version<"3.0"){for(var f,g=0;f=c[g++];){var h=f.geoCoord;h&&(e=!0,d=h)}for(var f,g=0;f=c[g++];){var i=f.markPoint||{},j=f.markLine||{},k=i.data;if(k&&k.length)for(var l=0,m=k.length;l<m;l++)e&&(k[l].geoCoord=d[k[l].name]),this._AddPos(k[l]);if(k=j.data,k&&k.length)for(var l=0,m=k.length;l<m;l++)e&&(k[l][0].geoCoord=d[k[l][0].name],k[l][1].geoCoord=d[k[l][1].name]),this._AddPos(k[l][0]),this._AddPos(k[l][1])}}this._ec.setOption(a,b)}},_AddPos:function(a){if(echarts.version<"3.0"){var b=echarts.version<"3.0"?a.geoCoord:a.coord,c=this.geoCoord2Pixel(b);a.x=c[0],a.y=c[1]}else{var b=a.coord,c=this.geoCoord2Pixel(b);a.coord=c}},_unbindEvent:function(){echarts.version<"3.0"?(this._ec.getZrender().un("dragstart",function(){}),this._ec.getZrender().un("dragend",function(){}),this._ec.getZrender().un("mouseup",function(){}),this._ec.getZrender().un("mousedown",function(){}),this._ec.getZrender().un("mousewheel",function(){})):(this._ec.getZr().off("dragstart",function(){}),this._ec.getZr().off("dragend",function(){}),this._ec.getZr().off("mouseup",function(){}),this._ec.getZr().off("mousedown",function(){}),this._ec.getZr().off("mousewheel",function(){}))}}),a.flowEcharts=function(b,c){return new a.FlowEcharts(b,c)},a.flowEcharts},window);