define(["Cesium"],function(e){"use strict";function t(t,i){this._id=e.createGuid(),this._guid=this.id,this._name=e.defaultValue(t.name,this.id),this._object=e.defaultValue(t.object,void 0),this._label=e.defaultValue(t.label,void 0),this._viewer=e.defaultValue(i,void 0),this._view={destination:new e.Cartesian3,orientation:{heading:0,pitch:e.Math.toRadians(-35),roll:0}},this._rectangle=void 0,this._type=void 0,this._isFlyCenter=!0,this.nodeType=t.nodeType,this.setType(),this.setCurrentView(),this.setRectangle()}function i(t){if(!e.defined(t)&&!t instanceof e.Viewer)throw new Error("viewer is required for ObjectManager.");this._viewer=t,this._labels=new e.LabelCollection,this._billboards=new e.BillboardCollection,this._pointPrimitives=new e.PointPrimitiveCollection,this._polylines=new e.PolylineCollection,this._entities=t.entities,this._entities.add({point:{}}),this._addedEvent=new e.Event,this._removedEvent=new e.Event,this.objectCollection={},this.initialize()}return t.prototype.setType=function(){var t=this,i=void 0;e.defined(i)||["Billboard","Label","PointPrimitive","Polyline","Polygon","Entity"].forEach(function(n,o){if(e.defined(e[n])&&t.object instanceof e[n])return i=n.substr(0,1).toLowerCase()+n.substring(1),!1}),this._type=i},t.prototype.setCurrentView=function(t){!this._viewer&&t instanceof e.Viewer&&(this._viewer=t),this._viewer instanceof e.Viewer&&(this._view.destination=e.Cartesian3.clone(this._viewer.camera.position),this._view.orientation.heading=this._viewer.camera.heading,this._view.orientation.pitch=this._viewer.camera.pitch,this._view.orientation.roll=this._viewer.camera.roll)},t.prototype.setRectangle=function(){try{if(this._object&&this._viewer){var t=void 0;switch(this._type){case"billboard":case"pointPrimitive":t=[this._object.position];break;case"polyline":t=this._object.positions}this._rectangle=e.Rectangle.fromCartesianArray(t,this._viewer.scene.ellipsoid,this._rectangle),this._rectangle.east=this._rectangle.east+.002,this._rectangle.north=this._rectangle.north+.002,this._rectangle.south=this._rectangle.south-.002,this._rectangle.west=this._rectangle.west-.002}}catch(e){}},t.prototype.setView=function(t,i,n,o){e.defined(t)&&t instanceof e.Cartesian3&&(this._view.destination=e.Cartesian3.clone(t)),e.defined(i)&&(this._view.orientation.heading=i),e.defined(n)&&(this._view.orientation.pitch=n),e.defined(o)&&(this._view.orientation.roll=o)},t.prototype.location=function(t){if(!this._viewer&&t instanceof e.Viewer&&(this._viewer=t),this._viewer&&this._viewer instanceof e.Viewer)if(this._isFlyCenter)this._object instanceof e.Entity?this._viewer.flyTo(this._object):this._viewer.scene.camera.flyTo({destination:this._rectangle,endTransform:e.Matrix4.IDENTITY});else{var i=new e.HeadingPitchRoll(this._view.orientation.heading,this._view.orientation.pitch,this._view.orientation.roll);this._viewer.scene.camera.flyTo({destination:this._view.destination,orientation:i,endTransform:e.Matrix4.IDENTITY})}},e.defineProperties(t.prototype,{name:{get:function(){return this._name},set:function(e){this._name=e}},id:{get:function(){return this._id}},guid:{get:function(){return this._guid}},object:{get:function(){return this._object},set:function(e){this._object=e,this.setType()}},type:{get:function(){return this._type}},label:{get:function(){return this._label}},show:{get:function(){try{if(this._object&&e.defined(this._object.show))return this._object.show}catch(e){}return!1},set:function(t){try{this._label&&this._label instanceof e.Label&&(this._label.show=t),this._object&&(this._object.show=t)}catch(e){}}},showLabel:{get:function(){try{if(this._label&&e.defined(this._label.show))return this._label.show}catch(e){}return!1},set:function(t){try{this._label&&this._label instanceof e.Label&&(this._label.show=t)}catch(e){}}},view:{get:function(){return this._view},set:function(e){this._view=e}},isFlyCenter:{get:function(){return this._isFlyCenter},set:function(e){this._isFlyCenter=e}}}),i.prototype.initialize=function(){this.viewer.scene.primitives.add(this.labels),this.viewer.scene.primitives.add(this.billboards),this.viewer.scene.primitives.add(this.pointPrimitives),this.viewer.scene.primitives.add(this.polylines)},i.prototype.addBillboard=function(i){i=e.defaultValue(i,e.defaultValue.EMPTY_OBJECT);var n=this.billboards.add(i),o=void 0;e.defined(i.label)&&(o=this.labels.add(i.label));var s=new t({name:i.name||void 0,object:n,label:o,nodeType:i.nodeType},this._viewer);return this.addCesiumObject(s)},i.prototype.addPoint=function(i){i=e.defaultValue(i,e.defaultValue.EMPTY_OBJECT);var n=this.pointPrimitives.add(i),o=void 0;e.defined(i.label)&&(o=this.labels.add(i.label));var s=new t({name:i.name||void 0,object:n,label:o,nodeType:i.nodeType},this._viewer);return this.addCesiumObject(s)},i.prototype.addPointEntity=function(i){i=e.defaultValue(i,e.defaultValue.EMPTY_OBJECT);var n=this._entities.add({show:!e.defined(i.show)||i.show,name:i.name,position:i.position,point:i,properties:i.properties}),o=void 0;e.defined(i.label)&&(o=this.labels.add(i.label));var s=new t({name:i.name||void 0,object:n,label:o,nodeType:i.nodeType},this._viewer);return this.addCesiumObject(s)},i.prototype.addPolyline=function(i){i=e.defaultValue(i,e.defaultValue.EMPTY_OBJECT);var n=this._polylines.add(i),o=void 0;e.defined(i.label)&&(o=this.labels.add(i.label));var s=new t({name:i.name||void 0,object:n,label:o,nodeType:i.nodeType},this._viewer);return this.addCesiumObject(s)},i.prototype.addPolylineEntity=function(i){i=e.defaultValue(i,e.defaultValue.EMPTY_OBJECT);var n=this._entities.add({show:!e.defined(i.show)||i.show,name:i.name,polyline:i,properties:i.properties}),o=void 0;e.defined(i.label)&&(o=this.labels.add(i.label));var s=new t({name:i.name||void 0,object:n,label:o,nodeType:i.nodeType},this._viewer);return this.addCesiumObject(s)},i.prototype.addPolygonEntity=function(i){i=e.defaultValue(i,e.defaultValue.EMPTY_OBJECT),!e.defined(i.hierarchy)&&e.defined(i.positions)&&(i.hierarchy=new e.PolygonHierarchy(i.positions));var n=this._entities.add({show:!e.defined(i.show)||i.show,name:i.name,polygon:i,properties:i.properties}),o=void 0;e.defined(i.label)&&(o=this.labels.add(i.label));var s=new t({name:i.name||void 0,object:n,label:o,nodeType:i.nodeType},this._viewer);return this.addCesiumObject(s)},i.prototype.addLabel=function(i){i=e.defaultValue(i,e.defaultValue.EMPTY_OBJECT);var n=this._labels.add(i),o=new t({name:i.name||i.text||void 0,object:n,label:void 0,nodeType:i.nodeType},this._viewer);return this.addCesiumObject(o)},i.prototype.addLabelEntity=function(i){i=e.defaultValue(i,e.defaultValue.EMPTY_OBJECT);var n=this._entities.add({show:!e.defined(i.show)||i.show,name:i.name,position:i.position,label:i}),o=new t({name:i.name||i.text||void 0,object:n,label:void 0,nodeType:i.nodeType},this._viewer);return this.addCesiumObject(o)},i.prototype.addEntity=function(e){var i=this._entities.add(e),n=new t({name:e.name||void 0,object:i,label:void 0,nodeType:e.nodeType},this._viewer);return this.addCesiumObject(n)},i.prototype.addCesiumObject=function(i){if(i instanceof t){switch(this.objectCollection[i.guid]=i,i.type){case"billboard":this._billboards.contains(i._object)||(i._object=this._billboards.add(i._object));break;case"pointPrimitive":this._pointPrimitives.contains(i._object)||(i._object=this._pointPrimitives.add(i._object));break;case"polyline":this._polylines.contains(i._object)||(i._object=this._polylines.add(i._object));break;case"polygon":break;case"entity":this._entities.contains(i._object)||(i._object=this._entities.add(i._object))}return i._label&&i._label instanceof e.Label&&(this._labels.contains(i._label)||(i._label=this._labels.add(i._label))),this.addedEvent.raiseEvent(i),i}},i.prototype.updateCesiumObject=function(e,i){if(e instanceof t&&(e=e.guid),"string"==typeof e)return this.removeCesiumObject(e),this.addCesiumObject(i)},i.prototype.getCesiumObject=function(t){if(e.defined(this.objectCollection[t]))return this.objectCollection[t]},i.prototype.removeCesiumObject=function(i){if(i instanceof t&&(i=i.guid),"string"==typeof i){var n=this.getCesiumObject(i);if(n)return n.label&&this.labels.remove(n.label),n.object&&(n.object instanceof e.Billboard?this._billboards.remove(n.object):n.object instanceof e.Label?this._labels.remove(n.object):n.object instanceof e.PointPrimitive?this._pointPrimitives.remove(n.object):n.object instanceof e.Polyline?this._polylines.remove(n.object):n.object instanceof e.Entity&&this._entities.remove(n.object)),this._removedEvent.raiseEvent(n),delete this.objectCollection[i],!0}return!1},i.prototype.remove=function(e){return this.removeCesiumObject(e)},i.prototype.raise=function(e){return!1},i.prototype.raiseToTop=function(e){return!1},i.prototype.lower=function(e){return!1},i.prototype.lowerToBottom=function(e){return!1},i.prototype.indexOf=function(e){return 1},e.defineProperties(i.prototype,{viewer:{get:function(){return this._viewer}},billboards:{get:function(){return this._billboards}},pointPrimitives:{get:function(){return this._pointPrimitives}},polylines:{get:function(){return this._polylines}},labels:{get:function(){return this._labels}},entities:{get:function(){return this._entities}},addedEvent:{get:function(){return this._addedEvent}},removedEvent:{get:function(){return this._removedEvent}},length:{get:function(){var e=0;for(var t in this.objectCollection)e++;return e}}}),i});