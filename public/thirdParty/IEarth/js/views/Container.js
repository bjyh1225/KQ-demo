define(["jquery","jqueryUI","Vue","libs/common/common","Cesium"],function(t,e,n,i,s){"use strict";function o(e){e=s.defaultValue(e,{});var o=i.newGuid(),h="container_"+o,a="container_body_"+o,l=['<div id="'+h+'" class="panel panel-primary" v-show="shown" :style="style">','<div class="panel-heading draggable-ele" v-show="showHeader" style="padding:8px 10px;">','<button :title="closeBtn" type="button" class="close" aria-hidden="true" @click="close" @touchend="close">&times;</button>','<h4 class="panel-title" v-show="showTitle" v-html="title"></h4>',"</div>",'<div class="panel-body" id="'+a+'" v-html="content" :style="bodyStyle"></div>',"</div>"].join("");e=s.defaultValue(e,{}),this._id=h,this._parentContainer=s.defaultValue(e.parentContainer,""),this._title=s.defaultValue(e.title,"Panel"),this._content=s.defaultValue(e.content,""),this._shown=s.defaultValue(e.shown,!0),this._showHeader=s.defaultValue(e.showHeader,!0),this._showTitle=s.defaultValue(e.showTitle,!0),this._showCloseBtn=s.defaultValue(e.showCloseBtn,!0),this._style=s.defaultValue(e.style,{position:"absolute",top:0,left:0,margin:0,width:"auto"}),this._bodyStyle=s.defaultValue(e.bodyStyle,{padding:"5px 8px"}),this._draggable=s.defaultValue(e.draggable,!1),this._resizable=s.defaultValue(e.resizable,!1),this._closed=void 0;var r=typeof this._parentContainer;"string"==r?this._parentContainer=t("#"+this._parentContainer):"object"==r&&(this._parentContainer instanceof jQuery||(this._parentContainer=t(this._parentContainer))),this._parentContainer.append(l),this._readyPromise=s.when.defer();var u,c=this,d=0;!function(t){var e=t.ui.mouse.prototype,n=e._mouseInit;t.extend(e,{_mouseInit:function(){this.element.bind("touchstart."+this.widgetName,t.proxy(this,"_touchStart")),n.apply(this,arguments)},_touchStart:function(e){this.element.bind("touchmove."+this.widgetName,t.proxy(this,"_touchMove")).bind("touchend."+this.widgetName,t.proxy(this,"_touchEnd")),this._modifyEvent(e),t(document).trigger(t.Event("mouseup")),this._mouseDown(e),console.log("i touchStart!")},_touchMove:function(t){d=1,this._modifyEvent(t),this._mouseMove(t),console.log("i touchMove!")},_touchEnd:function(t){if(0==d){var e=document.createEvent("Event");e.initEvent("click",!0,!0),this.handleElement[0].dispatchEvent(e)}this.element.unbind("touchmove."+this.widgetName).unbind("touchend."+this.widgetName),this._mouseUp(t),d=0,console.log("i touchEnd!")},_modifyEvent:function(t){t.which=1;var e=t.originalEvent.targetTouches[0];t.pageX=e.clientX,t.pageY=e.clientY}})}(jQuery),u=new n({el:"#"+h,data:{title:c._title,content:c._content,shown:c._shown,showHeader:c._showHeader,showTitle:c._showTitle,showCloseBtn:c._showCloseBtn,style:c._style,bodyStyle:c._bodyStyle,closeBtn:platformLanguage&&platformLanguage.close?platformLanguage.close:"关闭"},mounted:function(){c._panel=t("#"+h),c._body=t("#"+a),c._readyPromise.resolve()},methods:{close:function(){this.shown=!1,c._shown=!1,c.onClose(),"function"==typeof this._closed&&this._closed()}}}),c._vm=u,this._readyPromise.then(function(){c._draggable&&t("#"+h).draggable({handle:".panel-heading",cursor:"move",containment:"parent",refreshPositions:!1,start:function(){t("#"+h+" .draggable-ele").css("cursor","move"),c.unifyPositionOrigin()}}),c._resizable&&(t("#"+h).resizable(),c.unifyPositionOrigin())})}return o.prototype.setPosition=function(t,e,n,i){s.defined(t)?isNaN(t)||(t+="px"):t=this._panel.css("left"),s.defined(e)?isNaN(e)||(e+="px"):e=this._panel.css("right"),s.defined(n)?isNaN(n)||(n+="px"):n=this._panel.css("top"),s.defined(i)?isNaN(i)||(i+="px"):i=this._panel.css("bottom"),this._panel.css("left",t).css("right",e).css("top",n).css("bottom",i)},o.prototype.setPositionLeft=function(t){s.defined(t)?isNaN(t)||(t+="px"):t=this._panel.css("left"),this._panel.css("left",t)},o.prototype.setPositionRight=function(t){s.defined(t)?isNaN(t)||(t+="px"):t=this._panel.css("right"),this._panel.css("right",t)},o.prototype.setPositionTop=function(t){s.defined(t)?isNaN(t)||(t+="px"):t=this._panel.css("top"),this._panel.css("top",t)},o.prototype.setPositionBottom=function(t){s.defined(t)?isNaN(t)||(t+="px"):t=this._panel.css("bottom"),this._panel.css("bottom",t)},o.prototype.unifyPositionOrigin=function(){var t=this._panel.css("bottom"),e=this._panel.css("right");if(l(t)){var n=this._panel.height(),i=this._parentContainer.height(),o=t.replace(/[^0-9]/gi,"");this._panel.css("top",i-o-n+"px"),this._panel.css("bottom","auto")}if(l(e)){var h=this._panel.width(),a=this._parentContainer.width();o=e.replace(/[^0-9]/gi,"");this._panel.css("left",a-o-h+"px"),this._panel.css("right","auto")}function l(t){return!(!s.defined(t)||""===t||"auto"===t)}},o.prototype.show=function(t){this._vm.shown=t,t||this.onClose()},o.prototype.destroy=function(){try{var e=this._id;return t("#"+e).remove(),this.onClose(),!0}catch(t){}return!1},o.prototype.onClose=function(){},s.defineProperties(o.prototype,{vm:{get:function(){return this._vm}},parentContainer:{get:function(){return this._parentContainer}},panel:{get:function(){return this._panel}},body:{get:function(){return this._body}},title:{get:function(){return this._title},set:function(t){this._title=t,this._vm.title=t}},content:{get:function(){return this._content},set:function(t){this._content=t,this._vm.content=t}},shown:{get:function(){return this._shown},set:function(t){this._shown=t,this._vm.shown=t}},showHeader:{get:function(){return this._showHeader},set:function(t){this._showHeader=t,this._vm.showHeader=t}},showTitle:{get:function(){return this._showTitle},set:function(t){this._showTitle=t,this._vm.showTitle=t}},showCloseBtn:{get:function(){return this._showCloseBtn},set:function(t){this._showCloseBtn=t,this._vm.showCloseBtn=t}},style:{get:function(){return this._style},set:function(t){this._style=t,this._vm.style=t}},bodyStyle:{get:function(){return this._bodyStyle},set:function(t){this._bodyStyle=t,this._vm.bodyStyle=t}},readyPromise:{get:function(){return this._readyPromise}},closed:{get:function(){return this._closed},set:function(t){"function"==typeof t&&(this._closed=t)}}}),o});