define(["text!views/html/ToolBar.html","libs/common/common","libs/common/defined","libs/common/defaultValue","libs/common/defineProperties","jquery","Vue","Bootstrap","views/Container","views/LayerManager","views/BaseMapTerrain","views/AddData","views/Draw","views/Measure","views/Visualization","views/SceneSettings","views/PanoramaMap","views/Tours","views/ThreeDimensionalAnalysist","views/SceneAnalyse"],function(e,t,n,o,i,a,r,s,l,c,h,p,d,u,m,C,f,w,g,y){"use strict";var v={layerList:"图层列表",baseMapAndTerrain:"影像与地形",addData:"添加数据",draw:"绘 制",measure:"量 测",visualization:"可视化",saveImage:"图片输出",print:"打印",settings:"设置",skin:"皮肤",expanded:"展开",collapsed:"收起",tempExpCollapse:"收起",toolbarModalTitle:"提示",toolbarModalContent:"",panorama:"全景图",streetView:"街景图",tour:"飞行漫游",d3Analysist:"三维分析",scene:"场景"};for(var b in v)v[b]=window.platformLanguage[b]?window.platformLanguage[b]:v[b];var _=[{name:"Default",title:"",href:"js/libs/bootstrap/css/bootstrap.css"},{name:"Cerulean",title:"A calm blue sky",href:"js/libs/bootstrap/css/Cerulean/bootstrap.css"},{name:"Cosmo",title:"An ode to Metro",href:"js/libs/bootstrap/css/Cosmo/bootstrap.css"},{name:"Cyborg",title:"Jet black and electric blue",href:"js/libs/bootstrap/css/Cyborg/bootstrap.css"},{name:"Darkly",title:"Flatly in night mode",href:"js/libs/bootstrap/css/Darkly/bootstrap.css"},{name:"Flatly",title:"Flat and modern",href:"js/libs/bootstrap/css/Flatly/bootstrap.css"},{name:"Journal",title:"Crisp like a new sheet of paper",href:"js/libs/bootstrap/css/Journal/bootstrap.css"},{name:"Lumen",title:"Light and shadow",href:"js/libs/bootstrap/css/Lumen/bootstrap.css"},{name:"Paper",title:"Material is the metaphor",href:"js/libs/bootstrap/css/Paper/bootstrap.css"},{name:"Readable",title:"Optimized for legibility",href:"js/libs/bootstrap/css/Readable/bootstrap.css"},{name:"Sandstone",title:"A touch of warmth",href:"js/libs/bootstrap/css/Sandstone/bootstrap.css"},{name:"Simplex",title:"Mini and minimalist",href:"js/libs/bootstrap/css/Simplex/bootstrap.css"},{name:"Slate",title:"Shades of gunmetal gray",href:"js/libs/bootstrap/css/Slate/bootstrap.css"},{name:"Spacelab",title:"Silvery and sleek",href:"js/libs/bootstrap/css/Spacelab/bootstrap.css"},{name:"Superhero",title:"The brave and the blue",href:"js/libs/bootstrap/css/Superhero/bootstrap.css"},{name:"United",title:"Ubuntu orange and unique font",href:"js/libs/bootstrap/css/United/bootstrap.css"},{name:"Yeti",title:"A friendly foundation",href:"js/libs/bootstrap/css/Yeti/bootstrap.css"}];function S(n){n=o(n,{}),this._viewer=o(n.viewer,null),this._parentContainer=o(n.parentContainer,"cesiumContainer"),this._title=o(n.title,"Panel"),this._content=o(e,""),this._shown=o(n.shown,!0),this._showHeader=o(n.showHeader,!1),this._showTitle=o(n.showTitle,!0),this._showCloseBtn=o(n.showCloseBtn,!0),this._style=o(n.style,{position:"absolute",top:"10px",left:"10px",margin:"0",width:"auto"}),this._bodyStyle=o(n.bodyStyle,{margin:0,padding:0}),this._container=null,this._vm=null,this._id=t.newGuid(),this._containerCollection={},this.initialize(n)}return S.prototype.initialize=function(e){var t=this,n={parentContainer:this._parentContainer,title:this._title,content:this._content,shown:this._shown,showHeader:this._showHeader,showTitle:this._showTitle,showCloseBtn:this._showCloseBtn,style:this._style,bodyStyle:this._bodyStyle};this._container=new l(n),this._vm=new r({el:".module-toolbar-content",data:{guid:t._id,titles:v,classes:{expanded:["iconfont","icon-left"],collapsed:["iconfont","icon-right"],tempExpCollapse:["iconfont","icon-left"]},skinConfig:_,message:"Hello Vue!"},created:function(){this.titles.tempExpCollapse=this.titles.collapsed,this.classes.tempExpCollapse=this.classes.expanded},methods:{onBaseMapAndTerrainBtnClk:function(e){t.onBaseMapAndTerrainBtnClk(e)},onLayerListBtnClk:function(e){t.onLayerMangerBtnClk(e)},onAddDataLayerBtnClk:function(e){t.onAddDataLayerBtnClk(e)},onDrawBtnClk:function(e){t.onDrawBtnClk(e)},onMeasureBtnClk:function(e){t.onMeasureBtnClk(e)},onVisualizeBtnClk:function(e){t.onVisualizeBtnClk(e)},onSaveImageBtnClk:function(){a("#toolbarModalContent").html(this.titles.saveImage)},onOpen3dAnalysistBtnClk:function(){t.on3dAnalysistBtnClk()},onOpenSceneBtnClk:function(e){t.onOpenSceneBtnClk(e)},onPrintBtnClk:function(){a("#toolbarModalContent").html(this.titles.print)},onSceneSettingsBtnClk:function(e){t.onSceneSettingsBtnClk(e)},onExpandListBtnClk:function(){this.titles.tempExpCollapse==this.titles.expanded?this.titles.tempExpCollapse=this.titles.collapsed:this.titles.tempExpCollapse=this.titles.expanded,this.titles.tempExpCollapse==this.titles.expanded?this.classes.tempExpCollapse=this.classes.collapsed:this.classes.tempExpCollapse=this.classes.expanded},onToggleSkinBtnClk:function(e){document.getElementById("skin_link").href=this.skinConfig[e].href},on3DPanoramaBtnClk:function(e){t.on3DPanoramaBtnClk(e)},onToursBtnClk:function(e){t.onToursBtnClk(e)}}}),this.render()},S.prototype.render=function(){if(this._containerCollection.LayerManager)this._containerCollection.LayerManager.shown=!this._containerCollection.LayerManager.shown;else{var e={viewer:this._viewer,parentContainer:this._parentContainer,shown:!1,height:"80%"};this._containerCollection.LayerManager=new c(e),this.addServerDataByParams(this._viewer)}},S.prototype.decodeLocationRequestServerParams=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1),o=n.indexOf("&");if(-1!=o){var i=decodeURIComponent(escape(window.atob(n.substr(o+1)))).match(t);return null!=i?unescape(i[2]):void 0}},S.prototype.addImageryLayerForTerrain=function(e){var t=new Cesium.ImageryLayer(new Cesium.GoogleMapsImageryProvider({name:"Google Satellite Map",maptype:"satellite"}),{});t.name="Google Satellite Map",e.imageryLayers.add(t)},S.prototype.addServerDataByParams=function(e){var t=this.decodeLocationRequestServerParams("url"),n=this.decodeLocationRequestServerParams("type"),o=this.decodeLocationRequestServerParams("name");if(t&&n&&o){t=t?t.split("?")[0]:"";switch(n){case"1":var i=this.decodeLocationRequestServerParams("workspaceName"),a=this.decodeLocationRequestServerParams("rasterDatasetName");if(!i||!a)return;var r={name:o,url:t,workspaceName:i,rasterDatasetName:a};e.imageryLayers.addImageryProvider(new Cesium.KQGIS3DServerImageryProvider(r)).getViewableRectangle().then(function(t){return e.camera.flyTo({destination:t})});break;case"2":t.toLowerCase().indexOf(".xml")!==t.length-4&&(t+="/info.xml");r={name:o,url:t};e.imageryLayers.addImageryProvider(new Cesium.KQGIS3DTileFileImageryProvider(r)).getViewableRectangle().then(function(t){return e.camera.flyTo({destination:t})});break;case"3":i=this.decodeLocationRequestServerParams("workspaceName"),a=this.decodeLocationRequestServerParams("rasterDatasetName");if(!i||!a)return;r={name:o,url:t,workspaceName:i,rasterDatasetName:a};(c=new Cesium.KQGIS3DServerTerrainProvider(r)).readyPromise.then(function(t){if(t&&c.ExtentSource){var n=Cesium.Rectangle.fromDegrees(c.ExtentSource.left,c.ExtentSource.bottom,c.ExtentSource.right,c.ExtentSource.top);e.scene.camera.flyTo({destination:n})}}),e.terrainProvider=c,this.addImageryLayerForTerrain(e),this._containerCollection.LayerManager&&this._containerCollection.LayerManager.listenOnAddTerrain(c,o);break;case"4":t.toLowerCase().indexOf(".xml")!==t.length-4&&(t+="/info.xml");r={name:o,url:t};(c=new Cesium.KQGIS3DTileFileTerrainProvider(r)).readyPromise.then(function(t){if(t&&c.ExtentSource){var n=Cesium.Rectangle.fromDegrees(c.ExtentSource.left,c.ExtentSource.bottom,c.ExtentSource.right,c.ExtentSource.top);e.scene.camera.flyTo({destination:n})}}),e.terrainProvider=c,this.addImageryLayerForTerrain(e),this._containerCollection.LayerManager&&this._containerCollection.LayerManager.listenOnAddTerrain(c,o);break;case"5":t.toLowerCase().indexOf(".json")!==t.length-5&&(t+="/tileset.json");r={name:o,url:t,skipLevelOfDetail:!0,baseScreenSpaceError:1024,skipScreenSpaceErrorFactor:16,skipLevels:1,immediatelyLoadDesiredLevelOfDetail:!1,loadSiblings:!1,cullWithChildrenBounds:!0,shadows:0};e.scene.primitives.add(new Cesium.Cesium3DTileset(r)).readyPromise.then(function(t){e.zoomTo(t)});break;case"6":var s=this.decodeLocationRequestServerParams("isKq3dServer"),l=this.decodeLocationRequestServerParams("dataclassId");if("true"!=s&&!l)return;r={name:o,url:t,shadows:0,enablePickFeatures:!0,isKq3dServer:s,dataclassId:l};e.scene.primitives.add(new Cesium.Cesium3DTileset(r)).readyPromise.then(function(t){e.zoomTo(t)});break;case"7":t.lastIndexOf("/")!=t.length-1&&(t=t.substring(0,t.lastIndexOf("/")+1));var c;r={name:o,url:t,requestVertexNormals:!0,requestWaterMask:!1};(c=new Cesium.CesiumTerrainProvider(r)).readyPromise.then(function(t){if(t){if(c.bounds)var n=Cesium.Rectangle.fromDegrees.apply(null,c.bounds);e.scene.camera.flyTo({destination:n})}}),e.terrainProvider=c,this.addImageryLayerForTerrain(e),this._containerCollection.LayerManager&&this._containerCollection.LayerManager.listenOnAddTerrain(c,o);break;case"9":var h=Cesium.KmlDataSource.load(t);e.dataSources.add(h),e.zoomTo(h);break;case"10":h=new Cesium.CzmlDataSource(o).load(t);e.dataSources.add(h),e.zoomTo(h);break;case"11":var p=new Cesium.KQGIS3DServerRequest({url:t}),d=(i="",0),u=(a="",0),m=this;p.getServiceInfo().then(function(n){var r=n.workspaces;i=r[0].name,d=r[0].id,p.getWorkspaceInfo(d).then(function(n){n.datasets.forEach(function(n){a=n.name,u=n.id;var r={name:o,url:t,workspaceName:i,rasterDatasetName:a};p.getCapabilities(u).then(function(t){(console.log(t),t.dom)&&e.imageryLayers.addImageryProvider(new Cesium.KQGIS3DServerImageryProvider(r)).getViewableRectangle().then(function(t){return e.camera.flyTo({destination:t})});if(t.dem){var n=new Cesium.KQGIS3DServerTerrainProvider(r);n.readyPromise.then(function(t){if(t&&n.ExtentSource){var o=Cesium.Rectangle.fromDegrees(n.ExtentSource.left,n.ExtentSource.bottom,n.ExtentSource.right,n.ExtentSource.top);e.scene.camera.flyTo({destination:o})}}),e.terrainProvider=n,t.dom||m.addImageryLayerForTerrain(e),m._containerCollection.LayerManager&&m._containerCollection.LayerManager.listenOnAddTerrain(n,o)}},function(e){console.log(e.errorText)})})},function(e){console.log(e.errorText)})},function(e){console.log(e.errorText)})}}},S.prototype.onLayerMangerBtnClk=function(e){this.closeContainersException("LayerManager");var n=t.getElementAbsolutePosition(e.currentTarget),o={position:"absolute",top:n.top+e.currentTarget.clientHeight+10+"px",left:n.left+"px",height:"80%"};if(this._containerCollection.LayerManager)this._containerCollection.LayerManager.container.vm.style=o,this._containerCollection.LayerManager.shown=!this._containerCollection.LayerManager.shown;else{var i={viewer:this._viewer,parentContainer:this._parentContainer,style:o};this._containerCollection.LayerManager=new c(i)}},S.prototype.onBaseMapAndTerrainBtnClk=function(e){if(this.closeContainersException("BaseMapTerrain"),this._containerCollection.BaseMapTerrain)this._containerCollection.BaseMapTerrain.shown=!this._containerCollection.BaseMapTerrain.shown;else{var n=t.getElementAbsolutePosition(e.currentTarget),o={viewer:this._viewer,parentContainer:this._parentContainer,showHeader:!1,style:{position:"absolute",top:n.top+e.currentTarget.clientHeight+10+"px",left:n.left+"px"}};this._containerCollection.BaseMapTerrain=new h(o)}},S.prototype.onAddDataLayerBtnClk=function(e){this.closeContainersException(["AddData","LayerManager"]);var n=t.getElementAbsolutePosition(e.currentTarget),o=n.top+e.currentTarget.clientHeight+10+"px";if(!this._containerCollection.AddData){var i={viewer:this._viewer,parentContainer:this._parentContainer,shown:!1,showHeader:!0,style:{position:"absolute",top:o,left:n.left+"px"}};this._containerCollection.AddData=new p(i)}if(!this._containerCollection.AddData.shown){var r=this._containerCollection.AddData.container,s=r.vm.$el,l="calc(50% - "+(a(s).width()/2+"px")+")";r.vm.style.left=l,r.vm.style.top=o,a(s).css("left",l).css("top",o)}this._containerCollection.AddData.shown=!this._containerCollection.AddData.shown},S.prototype.onDrawBtnClk=function(e){if(this.closeContainersException("Draw"),this._containerCollection.Draw)this._containerCollection.Draw.shown=!this._containerCollection.Draw.shown;else{var n=t.getElementAbsolutePosition(e.currentTarget),o={viewer:this._viewer,parentContainer:this._parentContainer,style:{position:"absolute",top:n.top+e.currentTarget.clientHeight+10+"px",left:n.left+"px"}};this._containerCollection.Draw=new d(o)}},S.prototype.onMeasureBtnClk=function(e){if(this.closeContainersException("Measure"),this._containerCollection.Measure)this._containerCollection.Measure.shown=!this._containerCollection.Measure.shown;else{var n=t.getElementAbsolutePosition(e.currentTarget),o={viewer:this._viewer,parentContainer:this._parentContainer,showHeader:!0,style:{position:"absolute",top:n.top+e.currentTarget.clientHeight+10+"px",left:n.left+"px"}};this._containerCollection.Measure=new u(o)}},S.prototype.onVisualizeBtnClk=function(e){if(this.closeContainersException("Visualization"),this._containerCollection.Visualization)this._containerCollection.Visualization.shown=!this._containerCollection.Visualization.shown;else{var n=t.getElementAbsolutePosition(e.currentTarget),o={viewer:this._viewer,parentContainer:this._parentContainer,title:"&nbsp;",showHeader:!1,style:{position:"absolute",top:n.top+e.currentTarget.clientHeight+10+"px",left:n.left+"px"}};this._containerCollection.Visualization=new m(o)}},S.prototype.onSceneSettingsBtnClk=function(e){if(this.closeContainersException("SceneSettings"),!this._containerCollection.SceneSettings){var n=t.getElementAbsolutePosition(e.currentTarget),o={viewer:this._viewer,parentContainer:this._parentContainer,title:window.platformLanguage.settings||"设置",shown:!1,showHeader:!0,style:{position:"absolute",top:n.top+e.currentTarget.clientHeight+10+"px",left:n.left+"px"}};this._containerCollection.SceneSettings=new C(o)}this._containerCollection.SceneSettings.shown=!this._containerCollection.SceneSettings.shown,this._containerCollection.SceneSettings.update()},S.prototype.on3dAnalysistBtnClk=function(e){if(this.closeContainersException("3dAnalysist"),!this._containerCollection["3dAnalysist"]){var t={viewer:this._viewer,parentContainer:this._parentContainer,title:v.d3Analysist||"三维分析",shown:!1,showHeader:!0,style:{position:"absolute",top:"100px",right:"140px",width:"462px"}};this._containerCollection["3dAnalysist"]=new g(t)}this._containerCollection["3dAnalysist"].shown=!this._containerCollection["3dAnalysist"].shown},S.prototype.onOpenSceneBtnClk=function(e){if(this.closeContainersException("scene"),!this._containerCollection.scene){var n=t.getElementAbsolutePosition(e.currentTarget),o={viewer:this._viewer,parentContainer:this._parentContainer,title:v.scene||"场景",shown:!1,showHeader:!0,style:{position:"absolute",top:n.top+e.currentTarget.clientHeight+10+"px",left:n.left+"px",width:"370px"}};this._containerCollection.scene=new y(o)}this._containerCollection.scene.shown=!this._containerCollection.scene.shown},S.prototype.on3DPanoramaBtnClk=function(e){if(this.closeContainersException("PanoramaMap"),!this._containerCollection.PanoramaMap){var t={viewer:this._viewer,parentContainer:this._parentContainer};this._containerCollection.PanoramaMap=new f(t)}},S.prototype.onToursBtnClk=function(e){if(this.closeContainersException("Tours"),!this._containerCollection.Tours){var n=t.getElementAbsolutePosition(e.currentTarget),o={viewer:this._viewer,parentContainer:this._parentContainer,title:v.tour||"飞行漫游",shown:!1,showHeader:!0,style:{position:"absolute",top:n.top+e.currentTarget.clientHeight+10+"px",left:n.left+"px"}};this._containerCollection.Tours=new w(o)}this._containerCollection.Tours.shown=!this._containerCollection.Tours.shown},S.prototype.closeContainersException=function(e){for(var t in"string"==typeof e&&(e=[e]),!e instanceof Array&&(e=[]),this._containerCollection)a.inArray(t,e)<0&&(this._containerCollection[t].shown=!1)},i(S.prototype,{container:{get:function(){return this._container}},vm:{get:function(){return this._vm}},shown:{get:function(){return this._container.shown},set:function(e){this._container.shown=e}}}),S});