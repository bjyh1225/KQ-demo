!function i(o,l,s){function d(t,e){if(!l[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}var r=l[t]={exports:{}};o[t][0].call(r.exports,function(e){return d(o[t][1][e]||e)},r,r.exports,i,o,l,s)}return l[t].exports}for(var c="function"==typeof require&&require,e=0;e<s.length;e++)d(s[e]);return d}({1:[function(e,t,n){(function(e){"use strict";function t(){$(".colors-picker-input").kendoColorPicker({button:!1,change:a}),$(".point-size-silder").kendoSlider({min:1,max:20,smallStep:1,largeStep:1,showButtons:!1,tips:!1,change:a}).data("kendoSlider"),$(".heatmap-radius-silder").kendoSlider({min:1,max:20,smallStep:1,largeStep:1,showButtons:!1,tips:!1,change:a}).data("kendoSlider"),$(".line-width-silder").kendoSlider({min:0,max:20,smallStep:1,largeStep:1,showButtons:!1,tips:!1,change:a}).data("kendoSlider"),$(".opacity-slider").kendoSlider({min:0,max:100,smallStep:5,largeStep:10,showButtons:!1,change:a}).data("kendoSlider"),$(".line-style-list").kendoDropDownList({dataTextField:"name",dataValueField:"value",template:'<span class="k-state-default" style="background-image: url(./images/line_styles/line_style#:data.name#.png)"></span>',valueTemplate:'<span class="selected-value" style="background-image: url(./images/line_styles/line_style#:data.name#.png)"></span>',height:200,change:a}),$(".point-ramp-color").kendoDropDownList({dataTextField:"value",dataValueField:"name",template:'<span class="k-state-default" style="height: 12px; background-image: url(./images/color_ramp/color#:data.name#.png)"></span>',valueTemplate:'<span class="selected-value" style="background-image: url(./images/color_ramp/color#:data.name#.png)"></span>',height:200,change:function(){n(),initFieldColorContainer(),a()}}),$(".heatmap-ramp-color").kendoDropDownList({dataTextField:"value",dataValueField:"name",template:'<span class="k-state-default" style="height: 12px; background-image: url(./images/heatmap_ramp/color#:data.name#.png)"></span>',valueTemplate:'<span class="selected-value" style="background-image: url(./images/heatmap_ramp/color#:data.name#.png)"></span>',height:200,change:function(){n(),initFieldColorContainer(),a()}}),$(".line-ramp-color").kendoDropDownList({dataTextField:"value",dataValueField:"name",template:'<span class="k-state-default" style="height: 12px; background-image: url(./images/color_ramp/color#:data.name#.png)"></span>',valueTemplate:'<span class="selected-value" style="background-image: url(./images/color_ramp/color#:data.name#.png)"></span>',height:200,change:function(){n(),initFieldColorContainer(),a()}}),$(".polygon-ramp-color").kendoDropDownList({dataTextField:"value",dataValueField:"name",template:'<span class="k-state-default" style="height: 12px; background-image: url(./images/color_ramp/color#:data.name#.png)"></span>',valueTemplate:'<span class="selected-value" style="background-image: url(./images/color_ramp/color#:data.name#.png)"></span>',height:200,change:function(){n(),initFieldColorContainer(),a()}}),$(".special-field-list").kendoDropDownList({dataTextField:"name",dataValueField:"value",height:140,change:function(){n(),initFieldColorContainer(),a()}}),$(".sub-section-method-list").kendoDropDownList({dataTextField:"name",dataValueField:"value",height:140,change:function(){n(),initFieldColorContainer(),a()}}),$(".sub-section-count-list").kendoDropDownList({dataTextField:"name",dataValueField:"value",height:140,change:function(){n(),initFieldColorContainer(),a()}}),$(".label-direction-list").kendoDropDownList({dataTextField:"name",dataValueField:"value",height:140,change:a}),$(".label-offset-silder").kendoSlider({min:0,max:40,smallStep:1,largeStep:1,showButtons:!1,tips:!1,change:a}).data("kendoSlider"),$(".label-field-list").kendoDropDownList({dataTextField:"name",dataValueField:"value",height:140,change:a}),$(".weight-field-list").kendoDropDownList({dataTextField:"name",dataValueField:"value",height:140,change:a}),$(".label-font-list").kendoDropDownList({dataTextField:"name",dataValueField:"value",height:140,change:a});var t=$(".dv-input").kendoMaskedTextBox({change:a}).data("kendoMaskedTextBox");$("[data-role=maskedtextbox]").on("keydown",function(e){13===e.keyCode&&t.trigger("change",{data:$(this).val()})}),$(".point-type-switching").kendoButtonGroup({index:0}),$(".extra-icon-shape-list").kendoDropDownList({dataTextField:"name",dataValueField:"value",height:140,dataSource:[{name:"圆形",value:"circle"},{name:"方形",value:"square"},{name:"星形",value:"star"},{name:"五角星",value:"penta"}]})}function a(){var e=KQ.Builder.BuilderProject.getInstance(),t=e.setting.layer,n=t.getRenderType();if("hand-draw"===n){var a=KQ.Builder.BuilderProject.getInstance().setting.currentHandDrawModel,r=a.styleOptions;s(r,a),KQ.Map.MapGeomanStyleEditor.getInstance().changeStyle(KQ.Builder.BuilderProject.getInstance().setting.currentHandDrawLayer,r)}else{var i=e.getInfo("render_model"),o=i.styleOptions,l=t.render.get(n);i.pointSize?(o.vectorInfo.fillOpacity=i.pointOpacity/100,o.vectorInfo.strokeOpacity=i.lineOpacity/100,"vector"===o.pointSymbolType?o.vectorInfo.fontSize=i.pointSize+"px":o.imageInfo.radius=i.pointSize/10):s(o,i),"heatmap"===o.renderType&&(o.gradient=KQ.Common.CommonValues.heatmapColorRamp[o.colorIndex]),l.setOptions(o)}}function s(e,t){e.fillOpacity&&(e.fillOpacity=t.fillOpacity/100),e.lineOpacity&&(e.lineOpacity=t.lineOpacity/100)}function n(){var e=KQ.Builder.BuilderProject.getInstance();r(e.setting.layer,e.getInfo("render_model").styleOptions)}function r(e,t){var n=e.getRenderType(),a=e.render.get(n),r=t,i=a.options;"point"===e.options.featureType&&(r=r.vectorInfo,i=i.vectorInfo),"single"==n?(r.thematicColors=KQ.Builder.RenderShape.getThematicFieldColorsSingle(a.getGeojsonObject(),r.thematicField,r.colorIndex),i.thematicColors=r.thematicColors):"section"==n?(r.thematicColors=KQ.Builder.RenderShape.getThematicFieldColorsSection(a.getGeojsonObject(),r.thematicField,r.colorIndex,r.sectionMethod,r.sectionCount),i.thematicColors=r.thematicColors):"heatmap"==n&&(t.gradient=KQ.Common.CommonValues.heatmapColorRamp[t.colorIndex])}function i(){for(var e=document.getElementsByClassName("editor-common-uis"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n                <div class="editor-tool">\n                    <div class="text">过滤显示</div>\n                    <input class="dv-input" placeholder="featureID < 1000" data-bind="value: styleOptions.filter"/>\n                </div>\n                <div class="editor-tool lable-select">\n                    <div class="text">标签字段</div>\n                    <select class="label-field-list" data-bind="source: labelFieldDropDownList, value: styleOptions.labelField"></select>\n                </div>\n                <div class="editor-tool lable-style">\n                    <div class="text">标签颜色</div>\n                    <input class="colors-picker-input" data-role="colorpicker"\n                           data-bind="value: styleOptions.labelColor"/>\n                </div>\n                <div class="editor-tool lable-select">\n                    <div class="text">标签字体</div>\n                    <select class="label-font-list" data-bind="source: labelFontDropDownList, value: styleOptions.labelFontName"> </select>\n                </div>\n            ',e[t].appendChild(n)}}function o(){for(var e=document.getElementsByClassName("symbol-type-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n        <div class="editor-tool">\n          <div class="text">符号类型</div>\n          <ul class="point-symbol-type">\n            <li class="point-symbol point-symbol-svg">矢量</li>\n            <li class="point-symbol point-symbol-img">图片</li>\n          </ul>\n        </div>\n        ',e[t].appendChild(n);var a=$(".point-symbol-type").kendoMobileButtonGroup({index:0}).data("kendoMobileButtonGroup");KQ.Builder.BuilderProject.getInstance().symbolTypeGroupButton=a}}function l(){for(var e=document.getElementsByClassName("point-style-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n        <div class="editor-tool">\n          <div class="text">点样式</div>\n          <div class="default-point-icon">\n             <div class="iconfont" data-bind="html: styleOptions.vectorInfo.unicode"></div>\n             <div class="icon-container" style="display: none;" data-bind="style: { backgroundImage:  styleOptions.imageInfo.url }"></div>\n          </div>\n          <div class="symbols-container" style="display: none;">\n            <div class="symbols-box">\n            </div>\n          </div>\n        </div>\n        ',e[t].appendChild(n),$(e[t]).find(".default-point-icon div").eq(0).bind({icon_selected:function(e,t){KQ.Builder.BuilderProject.getInstance().getInfo("render_model").styleOptions.vectorInfo.unicode=t,$(this).html(t),$(this).css("display","block").siblings().css("display","none"),a()},symbol_type_vector:function(){$(this).css("display","block").siblings().css("display","none"),a()}}),$(e[t]).find(".default-point-icon div").eq(1).bind({icon_selected:function(e,t){var n=KQ.Builder.BuilderProject.getInstance().getInfo("render_model").styleOptions;n.imageInfo.url="url(./images/point_images/IMAGE"+t.row+"-"+t.col+".png)",$(this).css("background-image",n.imageInfo.url),$(this).css("display","block").siblings().css("display","none"),a()},symbol_type_image:function(){$(this).css("display","block").siblings().css("display","none"),a()}})}$(".default-point-icon").click(function(){$(this).next().css("display","block")}),$("body").click(function(e){$(e.target).parent().hasClass("default-point-icon")||$(".symbols-container").css("display","none")})}function d(){for(var e=document.getElementsByClassName("point-color-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n                <div class="text">点颜色</div>\n                <input class="colors-picker-input" data-role="colorpicker" data-bind="value: styleOptions.vectorInfo.fillColor"/>\n            </div>\n            ',e[t].appendChild(n)}}function c(){for(var e=document.getElementsByClassName("point-ramp-color-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n                <div class="text">点颜色</div>\n                <input class="point-ramp-color" data-bind="source: rampColorDropDownList, value: styleOptions.vectorInfo.colorIndex"/>\n            </div>          \n            ',e[t].appendChild(n)}}function u(){for(var e=document.getElementsByClassName("heatmap-ramp-color-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n                <div class="text">热点颜色</div>\n                <input class="heatmap-ramp-color" data-bind="source: heatmapRampColorDropDownList, value: styleOptions.colorIndex"/>\n            </div>          \n            ',e[t].appendChild(n)}}function p(){for(var e=document.getElementsByClassName("heatmap-weight-field-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n               <div class="text">权重字段</div>\n               <select class="weight-field-list" data-bind="source: weightFieldDropDownList, value: styleOptions.weightField"></select>\n            </div>          \n            ',e[t].appendChild(n)}}function m(){for(var e=document.getElementsByClassName("heatmap-filter-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n               <div class="text">过滤显示</div>\n               <input class="dv-input" placeholder="featureID < 1000" data-bind="value: styleOptions.filter"/>\n            </div>          \n            ',e[t].appendChild(n)}}function y(){for(var e=document.getElementsByClassName("point-size-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n                <div class="text">点大小</div>\n                <div class="value-container">\n                    <input class="point-size-silder" data-bind="value: pointSize"/>\n                    <input type="text" style="border: none;" data-bind="value: pointSize">\n                    <p stype="padding-right: 5px;">px</p>\n                </div>\n            </div>\n            ',e[t].appendChild(n)}}function f(){for(var e=document.getElementsByClassName("point-opacity-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n                <div class="text">点不透明度</div>\n                <div class="value-container">\n                    <input class="opacity-slider" data-bind="value: pointOpacity"/>\n                    <input type="text" style="border: none;" data-bind="value: pointOpacity">\n                    <p stype="padding-right: 5px;">%</p>\n                </div>\n            </div>           \n            ',e[t].appendChild(n)}}function v(){for(var e=document.getElementsByClassName("point-line-color-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n                <div class="text">线颜色</div>\n                <input class="colors-picker-input" data-role="colorpicker"\n                       data-bind="value: styleOptions.vectorInfo.strokeColor"/>\n            </div>\n            ',e[t].appendChild(n)}}function g(){for(var e=document.getElementsByClassName("point-line-width-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n                <div class="text">线宽度</div>\n                <div class="value-container">\n                    <input class="line-width-silder" data-bind="value: styleOptions.vectorInfo.strokeWidth"/>\n                    <input type="text" style="border: none;" data-bind="value: styleOptions.vectorInfo.strokeWidth">\n                    <p stype="padding-right: 5px;">px</p>\n                </div>\n            </div>\n            ',e[t].appendChild(n)}}function b(){for(var e=document.getElementsByClassName("point-line-opacity-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n                <div class="text">线不透明度</div>\n                <div class="value-container">\n                    <input class="opacity-slider" data-bind="value: lineOpacity"/>\n                    <input type="text" style="border: none;" data-bind="value: lineOpacity">\n                    <p stype="padding-right: 5px;">%</p>\n                </div>\n            </div>           \n            ',e[t].appendChild(n)}}function h(){for(var e=document.getElementsByClassName("point-special-field-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool lable-select">\n                <div class="text">专题字段</div>\n                <select class="special-field-list" data-bind="source: specialFieldDropDownList, value: styleOptions.vectorInfo.thematicField"/>\n            </div>         \n            ',e[t].appendChild(n)}}function x(){for(var e=document.getElementsByClassName("point-subsection-type-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool lable-select">\n                <div class="text">分段方法</div>\n                <select class="sub-section-method-list" data-bind="source: subsectionTypeDropDownList, value: styleOptions.vectorInfo.sectionMethod"/>\n            </div>         \n            ',e[t].appendChild(n)}}function B(){for(var e=document.getElementsByClassName("heatmap-radius-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n                <div class="text">热点半径</div>\n                <div class="value-container">\n                    <input class="heatmap-radius-silder" data-bind="value: styleOptions.radius"/>\n                    <input type="text" style="border: none;" data-bind="value: styleOptions.radius">\n                    <p stype="padding-right: 5px;">px</p>\n                </div>\n            </div>\n            ',e[t].appendChild(n)}}function w(){for(var e=document.getElementsByClassName("point-subsection-number-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool lable-select">\n                <div class="text">分段个数</div>\n                <select class="sub-section-count-list" data-bind="source: subsectionNumberDropDownList, value: styleOptions.vectorInfo.sectionCount"/>\n            </div>        \n            ',e[t].appendChild(n)}}function S(){for(var e=document.getElementsByClassName("label-direction-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool lable-select">\n                <div class="text">标签位置</div>\n                <select class="label-direction-list" data-bind="source: labelDirectionDropDownList, value: styleOptions.labelPosition"/>\n            </div>        \n            ',e[t].appendChild(n)}}function C(){for(var e=document.getElementsByClassName("label-offset-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool lable-select">\n                <div class="text">标签偏移</div>\n                <div class="value-container">\n                    <input class="label-offset-silder" data-bind="value: styleOptions.labelMarkerPadding"/>\n                    <input type="text" style="border: none;" data-bind="value: styleOptions.labelMarkerPadding">\n                    <p stype="padding-right: 5px;">px</p>\n                </div>\n            </div>        \n            ',e[t].appendChild(n)}}function L(){for(var e=document.getElementsByClassName("line-color-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n                <div class="text">线颜色</div>\n                <input class="colors-picker-input" data-role="colorpicker"\n                       data-bind="value: styleOptions.lineColor"/>\n            </div>\n            ',e[t].appendChild(n)}}function k(){for(var e=document.getElementsByClassName("line-style-list-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n                <div class="text">线样式</div>\n                <input class="line-style-list" style="width: 152px; height: 28px;"\n                       data-bind="source: lineStyleDropDownList, value: styleOptions.lineStyle"/>\n            </div>\n            ',e[t].appendChild(n)}}function D(){for(var e=document.getElementsByClassName("line-width-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n                <div class="text">线宽度</div>\n                <div class="value-container">\n                    <input class="line-width-silder" data-bind="value: styleOptions.lineWidth"/>\n                    <input type="text" style="border: none;" data-bind="value: styleOptions.lineWidth">\n                    <p stype="padding-right: 5px;">px</p>\n                </div>\n            </div>\n            ',e[t].appendChild(n)}}function I(){for(var e=document.getElementsByClassName("line-opacity-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n                <div class="text">线不透明度</div>\n                <div class="value-container">\n                    <input class="opacity-slider" data-bind="value: lineOpacity"/>\n                    <input type="text" style="border: none;" data-bind="value: lineOpacity">\n                    <p stype="padding-right: 5px;">%</p>\n                </div>\n            </div>           \n            ',e[t].appendChild(n)}}function Q(){for(var e=document.getElementsByClassName("line-ramp-color-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n                <div class="text">线颜色</div>\n                <input class="line-ramp-color"\n                       data-bind="source: lineRampColorDropDownList, value: styleOptions.colorIndex"/>\n            </div>          \n            ',e[t].appendChild(n)}}function R(){for(var e=document.getElementsByClassName("special-field-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool lable-select">\n                <div class="text">专题字段</div>\n                <select class="special-field-list" data-bind="source: specialFieldDropDownList, value: styleOptions.thematicField"/>\n            </div>         \n            ',e[t].appendChild(n)}}function K(){for(var e=document.getElementsByClassName("subsection-type-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool lable-select">\n                <div class="text">分段方法</div>\n                <select class="sub-section-method-list" data-bind="source: subsectionTypeDropDownList, value: styleOptions.sectionMethod"/>\n            </div>         \n            ',e[t].appendChild(n)}}function F(){for(var e=document.getElementsByClassName("subsection-number-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool lable-select">\n                <div class="text">分段个数</div>\n                <select class="sub-section-count-list" data-bind="source: subsectionNumberDropDownList, value: styleOptions.sectionCount"/>\n            </div>        \n            ',e[t].appendChild(n)}}function P(){for(var e=document.getElementsByClassName("polygon-ramp-color-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n                <div class="text">面颜色</div>\n                <input class="polygon-ramp-color" data-bind="source: rampColorDropDownList, value: styleOptions.colorIndex"/>\n            </div>          \n            ',e[t].appendChild(n)}}function O(){for(var e=document.getElementsByClassName("polygon-color-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool point-color">\n                <div class="text">面颜色</div>\n                <input class="colors-picker-input" data-role="colorpicker" data-bind="value: styleOptions.fillColor"/>\n            </div>   \n            ',e[t].appendChild(n)}}function T(){for(var e=document.getElementsByClassName("polygon-opacity-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool">\n                <div class="text">面不透明度</div>\n                  <div class="value-container">\n                     <input class="opacity-slider" data-bind="value: fillOpacity"/>\n                     <input type="text" style="border: none;" data-bind="value: fillOpacity">\n                     <p stype="padding-right: 5px;">%</p>\n                  </div>\n            </div>           \n            ',e[t].appendChild(n)}}function E(){for(var e=[{name:"未设置",value:""}],t=KQ.Builder.BuilderProject.getInstance().setting.layer.getRender(),n=Object.keys(t.geojsonObjectFields()),a=0;a<n.length;++a)e.push({name:n[a],value:n[a]});return e}function _(){return[{name:"圆形",value:"circle"},{name:"方形",value:"square"},{name:"星形",value:"star"},{name:"五角星",value:"penta"}]}e.builderInitDoms={},e.builderInitDoms.initAllDoms=function(){o(),l(),c(),d(),y(),f(),m(),B(),u(),p(),v(),g(),b(),h(),x(),w(),S(),C(),function(){for(var e=document.getElementsByClassName("point-type-switching-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <ul class="point-type-switching">\n                <li style="width: 113px">矢量点符号</li>\n                <li style="width: 113px">向量点符号</li>\n                <li style="width: 113px">图形点符号</li>\n            </ul>\n            ',e[t].appendChild(n)}}(),function(){for(var e=document.getElementsByClassName("point-render-type-0-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="hand-draw-svg-symbols" style="height: 130px; overflow: auto; width: 327px; margin: 10px"></div>\n           \n            <div class="hand-draw-extra-icon-shape-container"></div>\n            <div class="hand-draw-extra-icon-marker-color-container"></div>\n            <div class="hand-draw-extra-icon-icon-color-container"></div>\n            <div class="hand-draw-extra-icon-zoom-rate-container"></div>\n            ',e[t].appendChild(n)}!function(){$(".hand-draw-svg-symbols").empty();for(var e=["&#xe614","&#xe6e3","&#xe6ad","&#xe629","&#xe613","&#xe66b","&#xe65a","&#xe75f","&#xe656","&#xe679","&#xe657","&#xe652","&#xe615","&#xe67e","&#xe620","&#xe7df","&#xe667","&#xe666","&#xe642","&#xe640","&#xe628","&#xe67b","&#xeac9","&#xe63f","&#xe61a","&#xe64d","&#xe626","&#xe6cb","&#xe6b5","&#xe689","&#xe6f6","&#xe71c","&#xe646","&#xe6c7","&#xe671","&#xe66f","&#xe641","&#xe63e","&#xe63a","&#xe676","&#xe739","&#xe651","&#xe663","&#xe67a","&#xe677","&#xe612","&#xe81f","&#xe65c","&#xe664","&#xe665","&#xe61f","&#xe623","&#xe624","&#xe62a"],t=0;t<6;++t){for(var n=$('<div class="symbol-row"></div>'),a=0;a<9;++a){var r=$('<div class="iconfont"></div>');r.html(e[9*t+a]),n.append(r)}$(".hand-draw-svg-symbols").append(n)}}()}(),function(){for(var e=document.getElementsByClassName("hand-draw-extra-icon-shape-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool lable-select">\n                <div class="text">标记形状</div>\n                <select class="extra-icon-shape-list" data-bind="value: styleOptions.vectorInfo.shape"/>\n            </div>        \n            ',e[t].appendChild(n)}}(),function(){for(var e=document.getElementsByClassName("hand-draw-extra-icon-marker-color-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool lable-select">\n                <div class="text">标记颜色</div>\n                <input class="colors-picker-input" data-role="colorpicker" data-bind="value: styleOptions.vectorInfo.markerColor"/>\n            </div>        \n            ',e[t].appendChild(n)}}(),function(){for(var e=document.getElementsByClassName("hand-draw-extra-icon-icon-color-container"),t=0;t<e.length;t++){var n=document.createElement("div");n.innerHTML='\n            <div class="editor-tool lable-select">\n                <div class="text">Icon颜色</div>\n                    <input class="colors-picker-input" data-role="colorpicker"\n                           data-bind="value: styleOptions.vectorInfo.iconColor"/>\n            </div>        \n            ',e[t].appendChild(n)}}(),L(),k(),I(),D(),Q(),R(),K(),F(),O(),T(),P(),i(),t()},e.builderInitDoms.initPointDoms=function(){o(),l(),c(),d(),y(),f(),m(),B(),u(),p(),v(),g(),b(),h(),x(),w(),S(),C(),i(),t()},e.builderInitDoms.initLineDoms=function(){i(),L(),k(),I(),D(),Q(),R(),K(),F(),O(),T(),t()},e.builderInitDoms.initPolygonDoms=function(){i(),R(),K(),F(),P(),O(),T(),L(),k(),I(),D(),t()},e.builderInitDoms.lineStyleDropDownList=function(){for(var e=[],t=Object.values(KQ.Common.CommonValues.lineStyle),n=0;n<t.length;++n)e.push({name:String(n),value:t[n]});return e},e.builderInitDoms.labelFieldDropDownList=function(){return E()},e.builderInitDoms.labelFontDropDownList=function(){return[{name:"仿宋",value:KQ.Common.CommonValues.labelFontName.fangSong},{name:"宋体",value:KQ.Common.CommonValues.labelFontName.song},{name:"微软雅黑",value:KQ.Common.CommonValues.labelFontName.yaHei}]},e.builderInitDoms.specialFieldDropDownList=function(){for(var e=[],t=KQ.Builder.BuilderProject.getInstance().setting.layer.getRender(),n=Object.keys(t.geojsonObjectFields()),a=0;a<n.length;++a)e.push({name:n[a],value:n[a]});return e},e.builderInitDoms.rampColorDropDownList=function(){for(var e=[],t=0;t<30;++t)e.push({name:String(t),value:String(t)});return e},e.builderInitDoms.sectionSpecialFieldDropDownList=function(){for(var e=[],t=KQ.Builder.BuilderProject.getInstance().setting.layer.getRender(),n=Object.keys(t.geojsonObjectSectionFields()),a=0;a<n.length;++a)e.push({name:n[a],value:n[a]});return e},e.builderInitDoms.subsectionTypeDropDownList=function(){return[{name:"等距分段法",value:KQ.Common.CommonValues.classBreaksMethod.classBreaks_equidistant},{name:"等量分段法",value:KQ.Common.CommonValues.classBreaksMethod.classBreaks_quantile},{name:"对数分段法",value:KQ.Common.CommonValues.classBreaksMethod.classBreaks_logarithmic},{name:"K聚类分段法",value:KQ.Common.CommonValues.classBreaksMethod.classBreaks_k_means}]},e.builderInitDoms.subsectionNumberDropDownList=function(){for(var e=[],t=2;t<16;++t)e.push({name:String(t),value:t});return e},e.builderInitDoms.labelDirectionDropDownList=function(){return[{name:"中",value:"mid"},{name:"上",value:"up"},{name:"下",value:"down"},{name:"左",value:"left"},{name:"右",value:"right"}]},e.builderInitDoms.heatmapRampColorDropDownList=function(){for(var e=[],t=0;t<18;++t)e.push({name:String(t),value:String(t)});return e},e.builderInitDoms.weightFieldDropDownList=function(){return E()},e.builderInitDoms.fillSvgSymbols=function(){$(".symbols-box").empty();for(var r=["&#xe614","&#xe6e3","&#xe6ad","&#xe629","&#xe613","&#xe66b","&#xe65a","&#xe75f","&#xe656","&#xe679","&#xe657","&#xe652","&#xe615","&#xe67e","&#xe620","&#xe7df","&#xe667","&#xe666","&#xe642","&#xe640","&#xe628","&#xe67b","&#xeac9","&#xe63f","&#xe61a","&#xe64d","&#xe626","&#xe6cb","&#xe6b5","&#xe689","&#xe6f6","&#xe71c","&#xe646","&#xe6c7","&#xe671","&#xe66f","&#xe641","&#xe63e","&#xe63a","&#xe676","&#xe739","&#xe651","&#xe663","&#xe67a","&#xe677","&#xe612","&#xe81f","&#xe65c","&#xe664","&#xe665","&#xe61f","&#xe623","&#xe624","&#xe62a","&#xe62b","&#xe611","&#xe66d","&#xe660","&#xe64c","&#xe630"],e=function(n){for(var a=$('<div class="symbol-row"></div>'),e=function(e){var t=$('<div class="iconfont"></div>');t.html(r[6*n+e]),t.click(function(){$(this).closest(".editor-tool").find(".default-point-icon div").eq(0).trigger("icon_selected",r[6*n+e])}),a.append(t)},t=0;t<6;++t)e(t);$(".symbols-box").append(a)},t=0;t<10;++t)e(t)},e.builderInitDoms.fillImageSymbols=function(){$(".symbols-box").empty();for(var e=function(a){for(var r=$('<div class="symbol-row"></div>'),e=function(e){var t="background-image: url(./images/point_images/IMAGE"+a+"-"+e+".png);",n=$('<div class="point-img" ><div style="'+t+'"></div></div>');n.click(function(){$(this).closest(".editor-tool").find(".default-point-icon div").eq(1).trigger("icon_selected",{row:a,col:e})}),r.append(n)},t=1;t<=6;++t)e(t);$(".symbols-box").append(r)},t=1;t<=10;++t)e(t)},e.builderInitDoms.render=a,e.builderInitDoms.refreshThematicColors=r,e.builderInitDoms.extraIconShape=_}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){(function(e){"use strict";function r(e){return function(){var l=e.apply(this,arguments);return new Promise(function(i,o){return function t(e,n){try{var a=l[e](n),r=a.value}catch(e){return void o(e)}if(!a.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});i(r)}("next")})}}var t,n,a,i,o,l,s;function d(e){var t=void 0,n=KQ.Builder.BuilderProject.getInstance().analysis_controls[e].get(e+" src-layers");if(""===n.value())t=["both"];else{var a=KQ.Builder.BuilderLayerDatas.getInstance().getData(n&&n.value());if(void 0===a)t=[];else{var r=KQ.Common.CommonTools.getGeomFromFeatureCollection(a);t="Point"===r.geometries[0].type?["outer","left","both"]:"LineString"===r.geometries[0].type?["left","right","both"]:(r.geometries[0].type,["inner","outer","both"])}}return t}function c(t){var n=Number.parseFloat($(t+" .parameters-container > div").css("height")),a=Number.parseFloat($(t+" .toolbox-scrollbar").css("height")),r=$(t+" .toolbox-scrollbar div");a<n+44?r.css({display:"block"}):r.css({display:"none"}),$(t+" .parameters-container").scroll(function(){var e=$(t+" .parameters-container").scrollTop()/(n+44-a)*(a-204);r.css({transform:"translateY("+e+"px)"})})}function u(){var t=Number.parseFloat($(".mapsetting-content .layer-data-container > div").css("height")),n=Number.parseFloat($(".mapsetting-content .mapsetting-scrollbar").css("height")),a=$(".mapsetting-content .mapsetting-scrollbar div");n<t+34?a.css({display:"block"}):a.css({display:"none"}),$(".mapsetting-content .layer-data-container").scroll(function(){var e=$(".mapsetting-content .layer-data-container").scrollTop()/(t+34-n)*(n-204);a.css({transform:"translateY("+e+"px)"})})}e.createParametersHtml=function(e){createParameterSrcLayersHtml(e),createParameterDifferenceLayersHtml(e),createParameterOverlapLayersHtml(e),createParameterDestLayersHtml(e),createParameterGeoSRSHtml(e),createParameterDestGeoSRSHtml(e),createParameterPrjHtml(e),createParameterOutSRSHtml(e),createParameterOutSRSTypeHtml(e),createParameterAreaSRSHtml(e),createAnalysisItemRunHtml(e),createParameterGeometryAttributeHtml(e),createParameterExportShpFormatHtml(e),createParameterBufferSideTypeHtml(e),createParameterBufferRadiusHtml(e),createParameterGeometry1Html(e),createParameterGeometry2Html(e),createParameterOperatorTypeHtml(e),createParameterOperatorCheckGeoHtml(e),createParameterReturnFieldsAreaHtml(e),createParameterReturnFieldsLengthHtml(e),createParameterToleranceHtml(e),createParameterCheckParamsPointLimitHtml(e),createParameterCheckParamsAreaLimitHtml(e),createParameterResultHtml(e),createParameterHandleResultHtml(e),createParameterReturnResultButtonHtml(e),createParameterGroupFieldsHtml(e),createParameterSummaryFieldsHtml(e),createParameterSummarTypesHtml(e),createParameterFieldsHtml(e),createParameterOperationSymbolsHtml(e),createParameterFieldValuesHtml(e),createParameterSQLsHtml(e)},e.isValidElement=function(e){return 0<$(e).length},e.createParameterSrcLayersHtml=function(e){isValidElement(e+" .parameter-src-layers")&&$(e+" .parameter-src-layers").append('\n        <label>\n            源图层\n        </label>\n        <div class="control"></div>')},e.createParameterDifferenceLayersHtml=function(e){isValidElement(e+" .parameter-difference-layers")&&$(e+" .parameter-difference-layers").append('\n        <label>\n            差异图层\n        </label>\n        <div class="control"></div>')},e.createParameterOverlapLayersHtml=function(e){isValidElement(e+" .parameter-overlap-layers")&&$(e+" .parameter-overlap-layers").append('\n        <label>\n            叠置图层\n        </label>\n        <div class="control"></div>')},e.createParameterDestLayersHtml=function(e){isValidElement(e+" .parameter-dest-layers")&&$(e+" .parameter-dest-layers").append('\n        <label>\n             目标图层\n        </label>\n        <div class="control"></div>\n    ')},e.createParameterGeometry1Html=function(e){isValidElement(e+" .parameter-operator-geometry1")&&$(e+" .parameter-operator-geometry1").append('\n        <label>几何对象A</label>\n        <div class="control"></div>\n    ')},e.createParameterGeometry2Html=function(e){isValidElement(e+" .parameter-operator-geometry2")&&$(e+" .parameter-operator-geometry2").append('\n        <label>几何对象B</label>\n        <div class="control"></div>\n    ')},e.createParameterGeoSRSHtml=function(e){isValidElement(e+" .parameter-geo-srs")&&$(e+" .parameter-geo-srs").append('\n        <label>源图形空间参考</label>\n        <div class="control-text-area">\n            <textarea class="k-textbox"></textarea>\n        </div>\n    ')},e.createParameterPrjHtml=function(e){isValidElement(e+" .parameter-prj")&&$(e+" .parameter-prj").append('\n        <label>源空间参考</label>\n        <div class="control-text-area">\n            <textarea class="k-textbox"></textarea>\n        </div>\n    ')},e.createParameterDestGeoSRSHtml=function(e){isValidElement(e+" .parameter-dest-geo-srs")&&$(e+" .parameter-dest-geo-srs").append('\n        <label>目标图形空间参考</label>\n        <div class="control-text-area">\n            <textarea class="k-textbox"></textarea>\n        </div>\n    ')},e.createParameterOutSRSHtml=function(e){isValidElement(e+" .parameter-out-srs")&&$(e+" .parameter-out-srs").append('\n        <label>目标空间参考</label>\n        <div class="control-text-area">\n            <textarea class="k-textbox"></textarea>\n        </div>\n    ')},e.createParameterOutSRSTypeHtml=function(e){isValidElement(e+" .parameter-out-srs-type")&&$(e+" .parameter-out-srs-type").append('\n        <label>目标空间参考类型</label>\n        <div class="control"></div>\n    ')},e.createParameterAreaSRSHtml=function(e){isValidElement(e+" .parameter-area-srs")&&$(e+" .parameter-area-srs").append('\n        <label>计算面积所使用的空间参考</label>\n        <div class="control-text-area">\n            <textarea class="k-textbox"></textarea>\n        </div>\n    ')},e.createParameterReturnFieldsAreaHtml=function(e){isValidElement(e+" .parameter-return-fields-area")&&$(e+" .parameter-return-fields-area").append('\n        <label>返回图形的面积 (平方米)</label>\n        <div class="control">\n            <input type="text" class="k-input k-textbox">\n        </div>\n    ')},e.createParameterReturnFieldsLengthHtml=function(e){isValidElement(e+" .parameter-return-fields-length")&&$(e+" .parameter-return-fields-length").append('\n        <label>返回图形的长度 (米)</label>\n        <div class="control">\n            <input type="text" class="k-input k-textbox">\n        </div>\n    ')},e.createParameterToleranceHtml=function(e){isValidElement(e+" .parameter-tolerance")&&$(e+" .parameter-tolerance").append('\n        <label>容差 (米)</label>\n        <div class="control">\n            <input type="number" class="tolerance">\n        </div>\n    ')},e.createParameterCheckParamsPointLimitHtml=function(e){isValidElement(e+" .parameter-geometry-check-params-pointLimit")&&$(e+" .parameter-geometry-check-params-pointLimit").append('\n        <label>容差 (米)</label>\n        <div class="control">\n            <input class="pointLimit" type="number">\n        </div>\n    ')},e.createParameterCheckParamsAreaLimitHtml=function(e){isValidElement(e+" .parameter-geometry-check-params-areaLimit")&&$(e+" .parameter-geometry-check-params-areaLimit").append('\n        <label>最小面积 (平方米)</label>\n        <div class="control">\n            <input class="areaLimit" type="number">\n        </div>\n    ')},e.createParameterGeometryAttributeHtml=function(e){isValidElement(e+" .parameter-geometry-attribute")&&$(e+" .parameter-geometry-attribute").append('\n        <label>需要计算的属性参数</label>\n        <div class="control"></div>\n    ')},e.createParameterExportShpFormatHtml=function(e){isValidElement(e+" .parameter-exportshp-format")&&$(e+" .parameter-exportshp-format").append('\n        <label>返回给前端时的格式</label>\n        <div class="control"></div>\n    ')},e.createParameterBufferSideTypeHtml=function(e){isValidElement(e+" .parameter-buffer-sideType")&&$(e+" .parameter-buffer-sideType").append('\n        <label>缓冲区方向</label>\n        <div class="control">\n            <input type="text" class="sideType">\n        </div>\n    ')},e.createParameterBufferRadiusHtml=function(e){isValidElement(e+" .parameter-buffer-radius")&&$(e+" .parameter-buffer-radius").append('\n        <label>缓冲半径 (米)</label>\n        <div class="control">\n            <input type="number" class="radius" min="0" max="1000000">  \n        </div>\n    ')},e.createParameterOperatorTypeHtml=function(e){isValidElement(e+" .parameter-operator-type")&&$(e+" .parameter-operator-type").append('\n        <label>图形操作类型</label>\n        <div class="control"></div>\n    ')},e.createParameterOperatorCheckGeoHtml=function(e){isValidElement(e+" .parameter-operator-checkGeo")&&$(e+" .parameter-operator-checkGeo").append('\n        <label>是否检查几何</label>\n        <div class="control"></div>\n    ')},e.createParameterResultHtml=function(e){isValidElement(e+" .parameter-result")&&$(e+" .parameter-result").append('\n        <label>分析结果</label>\n        <div class="control-text-area">\n            <textarea class="k-textbox"></textarea>\n            <div class="copy" style="display: none;">复制</div>\n        </div>\n    ')},e.createParameterHandleResultHtml=function(e){isValidElement(e+" .parameter-handle-result")&&$(e+" .parameter-handle-result").append('\n        <label>结果图层名称</label>\n        <div class="control">\n            <input type="text" class="k-input k-textbox">\n            <div class="handle-button">\n                <button class="save-layer">保存图层</button>\n                <button class="cancel">撤销图层</button>\n            </div>\n        </div>\n    ')},e.createParameterReturnResultButtonHtml=function(e){isValidElement(e+" .parameter-return-result-button")&&$(e+" .parameter-return-result-button").append('\n      <div class="control">\n        <button class="return-result">分析结果</button>\n      </div>\n    ')},e.createAnalysisItemRunHtml=function(e){isValidElement(e+" .analysis-item-run")&&$(e+" .analysis-item-run").append('\n        <hr>\n        <div class="control k-primary k-button">运行分析</div>\n    ')},e.createParameterGroupFieldsHtml=function(e){isValidElement(e+" .parameter-groupfields")&&$(e+" .parameter-groupfields").append('\n        <label>分组字段</label>\n        <div class="control"></div>')},e.createParameterSummaryFieldsHtml=function(e){isValidElement(e+" .parameter-summaryfields")&&$(e+" .parameter-summaryfields").append('\n        <label>汇总字段</label>\n        <div class="control"></div>')},e.createParameterSummarTypesHtml=function(e){isValidElement(e+" .parameter-summarytypes")&&$(e+" .parameter-summarytypes").append('\n        <label>汇总类型</label>\n        <div class="control"></div>')},e.createParameterFieldsHtml=function(e){isValidElement(e+" .parameter-fields")&&$(e+" .parameter-fields").append('\n        <label>字段信息</label>\n        <div class="control"></div>')},e.createParameterOperationSymbolsHtml=function(e){isValidElement(e+" .parameter-operation-symbols")&&$(e+" .parameter-operation-symbols").append('\n        <div class="control">\n            <div>\n                <button class="equal"> = </button>\n                <button class="less-than"> < </button>\n                <button class="greater-than"> > </button>\n            </div>\n            \n            <div>\n                <button class="greater-or-equal"> >= </button>\n                <button class="less-or-equal" > <= </button>\n                <button class="greater-or-less-button"> <> </button>\n            </div>\n\n            <div>\n                <button class="like"> LIKE </button>\n                <button class="or"> OR </button>\n                <button class="and"> AND </button>\n            </div>\n        </div>')},e.createParameterFieldValuesHtml=function(e){isValidElement(e+" .parameter-field-values")&&$(e+" .parameter-field-values").append('\n        <label>字段值</label>\n        <div class="control">\n            <div class="field-values"></div>\n            <button style="width: 90px"> 获取唯一值 </button>\n        </div>')},e.createParameterSQLsHtml=function(e){isValidElement(e+" .parameter-sql")&&$(e+" .parameter-sql").append('\n        <label>查询条件</label>\n        <div class="control-text-area">\n            <textarea id="sql-condition" class="k-textbox"></textarea>\n        </div>')},e.initControls=function(e){var t=KQ.Builder.BuilderProject.getInstance();t.analysis_controls[e]=new Map,initSrcLayersControl(e),initDifferenceLayersControl(e),initOverlapLayersControl(e),initDestLayersControl(e),initPrjControl(e),initOperatorGeometry1LayersControl(e),initOperatorGeometry2LayersControl(e),initGeoSRSControl(e),initOutSRSControl(e),initOutSRSTypeControl(e),initDestGeoSRSControl(e),initGeometryAttributeControl(e),initExportShpFormatControl(e),initOperatorTypeControl(e),initOperatorCheckGeoControl(e),initBufferRadiusControl(e),initReturnFieldsAreaControl(e),initReturnFieldsLengthControl(e),initToleranceControl(e),initCheckParamsPointLimitControl(e),initCheckParamsAreaLimitControl(e),initResultControl(e),initHandleResultControl(e),initReturnResultButtonControl(e),initGroupFieldsControl(e),initSummaryFieldsControl(e),initSummaryTypesControl(e),initFieldsControl(e),initOperationSymbolsControl(e),initFieldValuesControl(e),t.analysis_controls[e].set(e+" run",$(e+" .analysis-item-run .control"))},e.setOverlayPanezIndex=function(e){mapView.getPane("overlayPane").style.zIndex=e},e.initSrcLayersControl=function(a){if(isValidElement(a+" .parameter-src-layers .control")){var e=KQ.Builder.BuilderProject.getInstance(),t=_createLayersControl(a+" .parameter-src-layers .control");t.bind("dataBound",r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:setTimeout(r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.trigger("change");case 1:case"end":return e.stop()}},e,this)})),100);case 1:case"end":return e.stop()}},e,this)}))),t.bind("change",r(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=KQ.Builder.BuilderProject.getInstance().analysis_controls[a],n=_getGeoSRSFromControl(a+" src-layers"),$(a+" .parameter-geo-srs .k-textbox").html(n),isValidElement(a+" .parameter-buffer-sideType .control .sideType")&&(t.get(a+" bufferSideType").setDataSource(d(a)),t.get(a+" bufferSideType").value(d(a)[0])),isValidElement(a+" .parameter-groupfields .control")&&isValidElement(a+" .parameter-summaryfields .control"))return e.next=7,fillGroupFieldsAndSummaryFields(a);e.next=7;break;case 7:if(isValidElement(a+" .parameter-fields .control"))return e.next=10,fillQueryFields(a);e.next=10;break;case 10:case"end":return e.stop()}},e,this)}))),e.analysis_controls[a].set(a+" src-layers",t)}},e.fillGroupFieldsAndSummaryFields=(t=r(regeneratorRuntime.mark(function e(t){var n,a,r,i,o,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=KQ.Builder.BuilderProject.getInstance().analysis_controls[t],e.next=3,getFieldsFromLayer(t,!0);case 3:(a=e.sent)?(r=[],i=[],a.groupfields.forEach(function(e){r.push({name:e.name,value:e.name})}),a.summaryfields.forEach(function(e){i.push({name:e.name,value:e.name})}),i.push({name:"面积",value:"$area$"}),i.push({name:"长度",value:"$length$"}),(o=n.get(t+" groupfields")).setDataSource(r),o.select(0),(l=n.get(t+" summaryfields")).setDataSource(i),l.select(0)):(n.get(t+" groupfields").setDataSource([]),n.get(t+" summaryfields").setDataSource([]));case 5:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)}),e.fillQueryFields=(n=r(regeneratorRuntime.mark(function e(t){var n,a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=KQ.Builder.BuilderProject.getInstance().analysis_controls[t],e.next=3,getQueryFields(t);case 3:a=e.sent,(r=n.get(t+" fields")).setDataSource(new kendo.data.DataSource({data:a})),r.select(r.element.children().first());case 7:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)}),e.getQueryFields=(a=r(regeneratorRuntime.mark(function e(t){var n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],isValidElement(t+" .parameter-fields .control"))return e.next=4,getFieldsFromLayer(t,!1);e.next=6;break;case 4:(a=e.sent)&&a.fields.forEach(function(e){n.push({name:e.name})});case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)}),e.initDifferenceLayersControl=function(e){if(isValidElement(e+" .parameter-difference-layers .control")){var t=KQ.Builder.BuilderProject.getInstance(),n=_createLayersControl(e+" .parameter-difference-layers .control");t.analysis_controls[e].set(e+" difference-layers",n)}},e.initOverlapLayersControl=function(e){if(isValidElement(e+" .parameter-overlap-layers .control")){var t=KQ.Builder.BuilderProject.getInstance(),n=_createLayersControl(e+" .parameter-overlap-layers .control");t.analysis_controls[e].set(e+" overlap-layers",n)}},e.initDestLayersControl=function(t){if(isValidElement(t+" .parameter-dest-layers .control")){var e=KQ.Builder.BuilderProject.getInstance(),n=_createLayersControl(t+" .parameter-dest-layers .control");n.bind("change",function(){var e=_getGeoSRSFromControl(t+" dest-layers");$(t+" .parameter-dest-geo-srs .k-textbox").html(e)}),e.analysis_controls[t].set(t+" dest-layers",n)}},e.initOperatorGeometry1LayersControl=function(e){if(isValidElement(e+" .parameter-operator-geometry1 .control")){var t=KQ.Builder.BuilderProject.getInstance(),n=_createLayersControl(e+" .parameter-operator-geometry1 .control");t.analysis_controls[e].set(e+" geometry1-layers",n)}},e.initOperatorGeometry2LayersControl=function(e){if(isValidElement(e+" .parameter-operator-geometry2 .control")){var t=KQ.Builder.BuilderProject.getInstance(),n=_createLayersControl(e+" .parameter-operator-geometry2 .control");t.analysis_controls[e].set(e+" geometry2-layers",n)}},e._createLayersControl=function(e){var t=KQ.Builder.BuilderCommon.layersControlDataSource();return $(e).kendoDropDownList({dataTextField:"name",dataValueField:"value",dataSource:t,index:0}).data("kendoDropDownList")},e._getGeoSRSFromControl=function(e){var t=KQ.Builder.BuilderProject.getInstance(),n=t.setting.analysisCurrentPage,a=t.analysis_controls[n].get(e),r=KQ.Builder.BuilderLayerDatas.getInstance().getData(a.value());return KQ.Builder.BuilderCommon.getGeoSRSFromGeojson(r)},e.initGeoSRSControl=function(e){if(isValidElement(e+" .parameter-geo-srs .k-textbox")){var t=KQ.Builder.BuilderProject.getInstance(),n=_getGeoSRSFromControl(e+" src-layers");$(e+" .parameter-geo-srs .k-textbox").html(n),t.analysis_controls[e].set(e+" geoSRS",$(e+" .parameter-geo-srs .k-textbox"))}},e.initPrjControl=function(e){if(isValidElement(e+" .parameter-prj .k-textbox")){var t=KQ.Builder.BuilderProject.getInstance();$(e+" .parameter-prj .k-textbox").html("EPSG:4326"),t.analysis_controls[e].set(e+" prj",$(e+" .parameter-prj .k-textbox"))}},e.initDestGeoSRSControl=function(e){if(isValidElement(e+" .parameter-dest-geo-srs .k-textbox")){var t=KQ.Builder.BuilderProject.getInstance(),n=_getGeoSRSFromControl(e+" dest-layers");$(e+" .parameter-dest-geo-srs .k-textbox").html(n),t.analysis_controls[e].set(e+" destGeoSRS",$(e+" .parameter-dest-geo-srs .k-textbox"))}},e.initOutSRSControl=function(e){if(isValidElement(e+" .parameter-out-srs .k-textbox")){var t=KQ.Builder.BuilderProject.getInstance();$(e+" .parameter-out-srs .k-textbox").html("EPSG:4326"),t.analysis_controls[e].set(e+" outSRS",$(e+" .parameter-out-srs .k-textbox"))}},e.initOutSRSTypeControl=function(e){if(isValidElement(e+" .parameter-out-srs-type .control")){var t=KQ.Builder.BuilderProject.getInstance(),n=$(e+" .parameter-out-srs-type .control").kendoDropDownList({dataSource:["proj4","epsg","wkt","esri"]}).data("kendoDropDownList");t.analysis_controls[e].set(e+" outSRSType",n)}},e.initGeometryAttributeControl=function(e){if(isValidElement(e+" .parameter-geometry-attribute .control")){var t=KQ.Builder.BuilderProject.getInstance(),n=[{text:"面积",value:"area"},{text:"长度",value:"length"},{text:"中心点",value:"center"},{text:"外接矩形",value:"bound"}],a=$(e+" .parameter-geometry-attribute .control").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:n,index:0,value:n[0]}).data("kendoDropDownList");t.analysis_controls[e].set(e+" geometryAttribute",a)}},e.initExportShpFormatControl=function(e){if(isValidElement(e+" .parameter-exportshp-format .control")){var t=KQ.Builder.BuilderProject.getInstance(),n=$(e+" .parameter-exportshp-format .control").kendoMultiSelect({dataSource:["filestream"]}).data("kendoMultiSelect");t.analysis_controls[e].set(e+" exportShpFormat",n)}},e.initBufferSideTypeControl=function(e){if(isValidElement(e+" .parameter-buffer-sideType .control .sideType")){var t=KQ.Builder.BuilderProject.getInstance(),n=$(e+" .parameter-buffer-sideType .control .sideType").kendoDropDownList({dataSource:d(e),value:d(e)[0]}).data("kendoDropDownList");t.analysis_controls[e].set(e+" bufferSideType",n)}},e.initOperatorTypeControl=function(e){if(isValidElement(e+" .parameter-operator-type .control")){var t=KQ.Builder.BuilderProject.getInstance(),n=$(e+" .parameter-operator-type .control").kendoDropDownList({dataSource:["intersect","equals","disjoint","touches","crosses","within","contains","overlaps"]}).data("kendoDropDownList");t.analysis_controls[e].set(e+" operatorType",n)}},e.initOperatorCheckGeoControl=function(e){if(isValidElement(e+" .parameter-operator-checkGeo .control")){var t=KQ.Builder.BuilderProject.getInstance(),n=$(e+" .parameter-operator-checkGeo .control").kendoDropDownList({dataSource:["true","false"]}).data("kendoDropDownList");t.analysis_controls[e].set(e+" operatorCheckGeo",n)}},e.initCheckParamsPointLimitControl=function(e){if(isValidElement(e+" .parameter-geometry-check-params-pointLimit .control .pointLimit")){var t=KQ.Builder.BuilderProject.getInstance(),n=$(e+" .parameter-geometry-check-params-pointLimit .control .pointLimit").kendoNumericTextBox({value:0}).data("kendoNumericTextBox");t.analysis_controls[e].set(e+" pointLimit",n)}},e.initCheckParamsAreaLimitControl=function(e){if(isValidElement(e+" .parameter-geometry-check-params-areaLimit .control .areaLimit")){var t=KQ.Builder.BuilderProject.getInstance(),n=$(e+" .parameter-geometry-check-params-areaLimit .control .areaLimit").kendoNumericTextBox({value:0}).data("kendoNumericTextBox");t.analysis_controls[e].set(e+" areaLimit",n)}},e.initBufferRadiusControl=function(e){if(isValidElement(e+" .parameter-buffer-radius .control .radius")){var t=KQ.Builder.BuilderProject.getInstance(),n=$(e+" .parameter-buffer-radius .control .radius").kendoNumericTextBox({value:1}).data("kendoNumericTextBox");t.analysis_controls[e].set(e+" bufferRadius",n)}},e.initResultControl=function(e){if(isValidElement(e+" .parameter-result .k-textbox")){var t=KQ.Builder.BuilderProject.getInstance(),n=$(e+" .parameter-result .k-textbox"),a=$(e+" .parameter-result .copy");t.analysis_controls[e].set(e+" result",n),t.analysis_controls[e].set(e+" copy",a)}},e.initHandleResultControl=function(e){if(isValidElement(e+" .parameter-handle-result .control")){var t=KQ.Builder.BuilderProject.getInstance(),n=$(e+" .parameter-handle-result .control .k-input.k-textbox"),a=$(e+" .parameter-handle-result .control .save-layer").kendoButton({enable:!1}).data("kendoButton"),r=$(e+" .parameter-handle-result .control .cancel").kendoButton({enable:!1}).data("kendoButton");t.analysis_controls[e].set(e+" resultLayerName",n),t.analysis_controls[e].set(e+" saveLayer",a),t.analysis_controls[e].set(e+" cancel",r)}},e.saveLayer=(i=r(regeneratorRuntime.mark(function e(t,n){var a,r,i,o,l,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={contentJson:n.toGeoJSON(),fileName:t,fileType:"geojson"},e.next=3,KQ.Common.NetworkTools.uploadJsonToFileServer(a);case 3:if("error"==(r=e.sent).result)return KQ.Control.Notification.getInstance().showError("保存图层失败！"),e.abrupt("return");e.next=7;break;case 7:return i={type:"STATIC_DATA",url:r.downloadPath,name:t},e.next=10,KQ.Builder.BuilderCommon.addNewLayer(i);case 10:o=e.sent,l=o.getRender(),s=L.extend(l.options,{fillColor:"red",fillOpacity:.2,lineColor:"red",lineWidth:3}),n.remove(),l.setOptions(s),KQ.Builder.BuilderProject.getInstance().siderbar.open("layers"),KQ.Data.DataManager.getInstance().addWebFileDataSourceInfo(i);case 17:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)}),e.refreshButtonState=function(e,t){var n=KQ.Builder.BuilderProject.getInstance().analysis_controls[e];"saveLayerButtonOpen"===t.saveLayerButtonOpen&&n.get(e+" saveLayer").enable(!0),"cancelLayerButtonOpen"===t.cancelLayerButtonOpen&&n.get(e+" cancel").enable(!0),"saveLayerButtonClose"===t.saveLayerButtonClose&&n.get(e+" saveLayer").enable(!1),"cancelLayerButtonClose"===t.cancelLayerButtonClose&&n.get(e+" cancel").enable(!1),"returnResultButtonOpen"===t.returnResultButtonOpen&&n.get(e+" returnResultButton").enable(!0)},e.initReturnFieldsAreaControl=function(e){if(isValidElement(e+" .parameter-return-fields-area .control .k-input.k-textbox")){var t=KQ.Builder.BuilderProject.getInstance(),n=$(e+" .parameter-return-fields-area .control .k-input.k-textbox");t.analysis_controls[e].set(e+" returnFieldsArea",n)}},e.initReturnFieldsLengthControl=function(e){if(isValidElement(e+" .parameter-return-fields-length .control .k-input.k-textbox")){var t=KQ.Builder.BuilderProject.getInstance(),n=$(e+" .parameter-return-fields-length .control .k-input.k-textbox");t.analysis_controls[e].set(e+" returnFieldsLength",n)}},e.initToleranceControl=function(e){if(isValidElement(e+" .parameter-tolerance .control .tolerance")){var t=KQ.Builder.BuilderProject.getInstance(),n=$(e+" .parameter-tolerance .control .tolerance").kendoNumericTextBox({value:0}).data("kendoNumericTextBox");t.analysis_controls[e].set(e+" tolerance",n)}},e.returnFields=function(e,t,n){var a=KQ.Builder.BuilderProject.getInstance().analysis_controls[e];if("area"===n){var r=a.get(e+" returnFieldsArea");if("GeometryCollection"===t.type){for(var i=0,o=0;o<t.geometries.length;o++)null==t.geometries[o].Area&&(t.geometries[o].Area=0),i+=t.geometries[o].Area;r.val(i.toFixed(4))}else r.val(t.Area.toFixed(4))}else if("length"===n){var l=a.get(e+" returnFieldsLength");if("GeometryCollection"===t.type){for(var s=0,d=0;d<t.geometries.length;d++)null==t.geometries[d].Length&&(t.geometries[d].Length=0),s+=t.geometries[d].Length;l.val(s.toFixed(4))}else l.val(t.Length.toFixed(4))}},e.copyResult=function(e){var t=KQ.Builder.BuilderProject.getInstance().analysis_controls[e],n=t.get(e+" copy"),a=$(e+" .parameter-result .control-text-area"),r=t.get(e+" result");a.mouseenter(function(){n.css("display","block")}),a.mouseleave(function(){n.css("display","none")}),n.click(function(){r.select(),document.execCommand("copy"),""!==r.val()&&(n.html("复制成功"),n.css("background","#28A344"),setTimeout(function(){n.html("复制"),n.css("background","#fff")},1e3))})},e.initReturnResultButtonControl=function(e){if(isValidElement(e+" .parameter-return-result-button .control .return-result")){var t=KQ.Builder.BuilderProject.getInstance(),n=$(e+" .parameter-return-result-button .control .return-result").kendoButton({enable:!1}).data("kendoButton");t.analysis_controls[e].set(e+" returnResultButton",n)}},e.returnResultTableDataSource=function(e,t,n){if("area"===n)for(var a=0;a<e.length;a++)t.push(e[a]);else if("length"===n)for(var r=0;r<e.length;r++)t.push(e[r]);else if("center"===n)for(var i=0;i<e.length;i++)t.push({id:e[i].id,center:e[i].center.toString()});else if("bound"===n)for(var o=0;o<e.length;o++)t.push({id:e[o].id,bound:e[o].bound.toString()})},e.initGroupFieldsControl=function(e){if(isValidElement(e+" .parameter-groupfields .control")){var t=KQ.Builder.BuilderProject.getInstance(),n=$(e+" .parameter-groupfields .control").kendoDropDownList({dataTextField:"name",dataValueField:"value",dataSource:[],index:0}).data("kendoDropDownList");t.analysis_controls[e].set(e+" groupfields",n)}},e.initSummaryFieldsControl=function(t){if(isValidElement(t+" .parameter-summaryfields .control")){var e=KQ.Builder.BuilderProject.getInstance(),n=$(t+" .parameter-summaryfields .control").kendoDropDownList({dataTextField:"name",dataValueField:"value",dataSource:[],index:0}).data("kendoDropDownList");setTimeout(r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fillGroupFieldsAndSummaryFields(t);case 2:case"end":return e.stop()}},e,this)})),0),e.analysis_controls[t].set(t+" summaryfields",n)}},e.initSummaryTypesControl=function(e){if(isValidElement(e+" .parameter-summarytypes .control")){var t=KQ.Builder.BuilderProject.getInstance(),n=$(e+" .parameter-summarytypes .control").kendoMultiSelect({dataTextField:"name",dataValueField:"value",dataSource:[{name:"求和",value:"sum"},{name:"最小值",value:"min"},{name:"最大值",value:"max"},{name:"平均值",value:"avg"},{name:"计数",value:"count"}],value:["min"]}).data("kendoMultiSelect");t.analysis_controls[e].set(e+" summarytypes",n)}},e.getDatasourceInfo=(o=r(regeneratorRuntime.mark(function e(t){var n,a,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=KQ.Builder.BuilderProject.getInstance(),a=n.analysis_controls[t],r=a.get(t+" src-layers"),i=KQ.Builder.BuilderProject.getInstance().getLayerFromGuid(r.value())){e.next=8;break}return e.abrupt("return",null);case 8:return e.abrupt("return",i.options.dataSource);case 9:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)}),e.getDatasource=function(e){return{type:"dataservice",url:e.url+"/proc",datasourceid:e.datasourceId,featureclassname:e.featureClassName}},e.getFieldsFromLayer=(l=r(regeneratorRuntime.mark(function e(t,n){var a,r,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,getDatasourceInfo(t);case 2:if(a=e.sent){e.next=7;break}return e.abrupt("return",null);case 7:if("DS_DATA"!==a.type)return KQ.Control.Notification.getInstance().showError("请求失败，非数据服务数据！",0),e.abrupt("return",null);e.next=12;break;case 12:return r=getDatasource(a),i=new KQ.ServiceTool.ServiceToolAnalysisServerFields,e.next=16,i.getFieldsResult({datasource:encodeURIComponent(JSON.stringify(r)),isSummaryField:n}).then(function(e){return"error"===e||"error"===JSON.parse(e).resultcode?(KQ.Control.Notification.getInstance().showError("获取图层字段失败！",0),null):JSON.parse(e).result});case 16:return o=e.sent,e.abrupt("return",o);case 18:case"end":return e.stop()}},e,this)})),function(e,t){return l.apply(this,arguments)}),e.initFieldsControl=(s=r(regeneratorRuntime.mark(function e(t){var n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(isValidElement(t+" .parameter-fields .control")){e.next=4;break}return e.abrupt("return");case 4:n=KQ.Builder.BuilderProject.getInstance(),a=$(t+" .parameter-fields .control").kendoListView({dataSource:{data:[]},template:"<div>#:name#</div>",selectable:!0}).data("kendoListView"),setTimeout(r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fillQueryFields(t);case 2:case"end":return e.stop()}},e,this)})),0),$(t+" .parameter-fields .control").dblclick(function(){var e=a.dataItem(a.select()).name;addSQLCondition(e)}),n.analysis_controls[t].set(t+" fields",a);case 9:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)}),e.addSQLCondition=function(e){var t=$("#sql-condition").val()+" "+e;$("#sql-condition").val(t)},e.initOperationSymbolsControl=function(e){isValidElement(e+" .parameter-operation-symbols .control")&&($(e+" .parameter-operation-symbols .control button").kendoButton({click:function(){addSQLCondition($.trim(this.element.text()))}}),$(e+" .parameter-operation-symbols .control button").css("width","32%"),$(e+" .parameter-operation-symbols .control div").css("margin-top","8px"))},e.initFieldValuesControl=function(l){if(isValidElement(l+" .parameter-field-values .control")){var e,s=$(l+" .parameter-field-values .control .field-values").kendoListView({dataSource:{data:[]},template:"<div>#:name#</div>",selectable:!0}).data("kendoListView");$(l+" .parameter-field-values .control button").kendoButton({click:(e=r(regeneratorRuntime.mark(function e(){var t,n,a,r,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,getDatasourceInfo(l);case 2:if(t=e.sent){e.next=7;break}return e.abrupt("return",null);case 7:if("DS_DATA"===t.type){e.next=11;break}KQ.Control.Notification.getInstance().showError("请求失败，非数据服务数据！",0),e.next=18;break;case 11:return n=getDatasource(t),a=$(l+" .parameter-fields .control").data("kendoListView"),r=a.dataItem(a.select()),i=r.name,o=new KQ.ServiceTool.ServiceToolAnalysisServerExecute,e.next=18,o.getExecuteResult({datasource:encodeURIComponent(JSON.stringify(n)),sql:"select distinct("+i+") from "+n.featureclassname+" order by "+i}).then(function(e){if("error"===e||"error"===JSON.parse(e).resultcode)KQ.Control.Notification.getInstance().showError("请求失败！",0);else if(KQ.Control.Notification.getInstance().showSuccess("请求成功！",0),"success"===(e=JSON.parse(e)).resultcode){var t=e.result.features,n=[];t.forEach(function(e){n.push({name:e.properties[i]})}),s.setDataSource(new kendo.data.DataSource({data:n})),s.select(0)}else s.setDataSource([])});case 18:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})}),$(l+" .parameter-field-values .control .field-values").dblclick(function(){var e=s.dataItem(s.select()).name;addSQLCondition(e)}),$(l+" .parameter-field-values .control").children().css("margin","4px 0")}},e.initMap=function(i,o){var e=KQ.Map.MapConfig.getInstance(),l=KQ.Builder.BuilderProject.getInstance(),s=null;e.initAsync("",!1,function(){KQ.Local.setLanguage("cn"),s=new KQ.Map.MapView({center:[40,-50],zoom:2}),(l.mapView=s).initAsync(r(regeneratorRuntime.mark(function e(){var t,n,a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new L.eventForwarder({map:s._getMap(),events:{click:!0,mousemove:!1},throttleMs:100,throttleOptions:{leading:!0,trailing:!1}})).enable(),s._getMap().mapEventForwarder=t,KQ.Control.Waiting.show(s._getMap(),"pin","meter"),e.prev=5,initHtml(),initSiderbar(s),e.next=10,initLayersContainer(null);case 10:return e.next=12,initHandDrawLayersContainer();case 12:return e.next=14,initMapGeoman();case 14:if(n=KQ.Control.MapBaseLayer.getLayers("geoq","blue"),l.basemapGroup=L.layerGroup(n),l.basemapGroup.addTo(s._getMap()),(a=$(".basemap-list").data("kendoListView")).select(a.element.children().first()),i)return r=KQ.Builder.BuilderPortalProxy.downloadUrl(i),e.next=23,loadProject(r);e.next=24;break;case 23:o&&$("#current-project-name").text(o);case 24:KQ.Builder.BuilderPortal.isPortalEnvironment()&&$("[data-type=clouddown]").css("display","none");case 25:return e.prev=25,setTimeout(function(){KQ.Control.Waiting.close(),KQ.Builder.BuilderProject.getInstance().siderbar.open("layers"),KQ.Builder.BuilderUi.CreateFirstMapDialog.getInstance().init()},1e3),KQ.Builder.BuilderUpdate.getInstance().bindEvent(),e.finish(25);case 30:case"end":return e.stop()}},e,this,[[5,,25,30]])}))),l.mapView=s})},e.onmouseenterHandleBaseMap=function(e){$(e).parent().addClass("largeSize"),$(e).children(".secound-line").css("display","block"),$(e).find(".fa-eye").css("opacity","1")},e.onmouseleaveHandleBaseMap=function(e){$(e).parent().removeClass("largeSize"),$(e).children(".secound-line").css("display","none"),$(e).find(".fa-eye").css("opacity","0")},e.toggleBaseMapVisible=function(e){event.stopPropagation();var t=KQ.Builder.BuilderProject.getInstance().basemapGroup;if($(e).hasClass("fa-eye"))$(e).removeClass("fa-eye"),$(e).addClass("fa-eye-slash"),$(e).closest("li").css("opacity",.65),$(e).closest("li").css("pointer-events","none"),t.clearLayers();else{$(e).addClass("fa-eye"),$(e).removeClass("fa-eye-slash"),$(e).closest("li").css("opacity",1),$(e).closest("li").css("pointer-events","auto");for(var n=$(e).closest("li").attr("data-type"),a=$(e).closest("li").attr("data-sub-type"),r=KQ.Control.MapBaseLayer.getLayers(n,a),i=0;i<r.length;++i)t.addLayer(r[i])}$(e).css("pointer-events","auto")},e.addHandDrawLayerItem=function(e,t){KQ.Builder.BuilderProject.getInstance().handDrawLayersContainer.add({id:e,name:"测试数据3",type:t})},e.builderInit=function(){loadHtml(initMap)},e.toolBoxScrollBar=function(e){c(e),$(window).resize(function(){c(e)})},e.settingScrollBar=function(){$(window).on("click",function(){$("#settings").hasClass("active")&&(u(),$(window).resize(function(){u()}))})},e.changeDialogBackgroundColor=function(e,t){$(e).parent().css("backgroundColor",t)},e.getTranslateY=function(e){var t=e.style.transform,n=void 0;return t?null===(n=/translate(Y|\dd)?\(\s*(\w+\s*,)?\s*([^,]+)(\s*,[^)]+)?\s*\)/.exec(t))?(n=/matrix\(.*,\s*(\w+)\s*\)/.exec(t))?n[1]:null:n[3]:null},e.formatJson=function(e,t){var i="",o=0,n=function(e,t){var n=null;if("[object String]"!==Object.prototype.toString.call(e))try{n=JSON.stringify(e)}catch(e){console.error("您传递的json数据格式有误，请核对..."),console.error(e),t(e)}else try{e=e.replace(/(\')/g,'"'),n=JSON.stringify(JSON.parse(e))}catch(e){console.error("您传递的json数据格式有误，请核对..."),console.error(e),t(e)}return n}(e,t);if(!n)return n;var a=[],r=null,l=null,s=[];return n=(n=(n=(n=(n=n.replace(/([\{\}])/g,"\r\n$1\r\n")).replace(/([\[\]])/g,"\r\n$1\r\n")).replace(/(\,)/g,"$1\r\n")).replace(/(\r\n\r\n)/g,"\r\n")).replace(/\r\n\,/g,","),(s=n.split("\r\n")).forEach(function(e,t){var n=e.match(/\"/g)?e.match(/\"/g).length:0;n%2&&!r&&(r=t),n%2&&r&&r!==t&&(l=t),r&&l&&(a.push({start:r,end:l}),l=r=null)}),a.reverse().forEach(function(e,t){var n=s.slice(e.start,e.end+1);s.splice(e.start,e.end+1-e.start,n.join(""))}),(s=(n=(n=(n=s.join("\r\n")).replace(/\:\r\n\{/g,":{")).replace(/\:\r\n\[/g,":[")).split("\r\n")).forEach(function(e,t){var n=0,a=0,r="";for(e.match(/\{$/)||e.match(/\[$/)?a+=1:e.match(/\}$/)||e.match(/\]$/)||e.match(/\},$/)||e.match(/\],$/)?0!==o&&(o-=1):a=0,n=0;n<o;n++)r+="    ";i+=r+e+"\r\n",o+=a}),i.trim()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,n){"use strict";var i=null;$.fn.buildersidebar=function(e){var n=this,a=n.find("ul.buildersidebar-tabs, .buildersidebar-tabs > ul"),r=n.children(".buildersidebar-content").first();return e=$.extend({position:"left",onOpened:function(e){console.log("sidebar run onOpened! id:"+e)},onClosed:function(){console.log("sidebar run onClosed!")}},e||{}),n.options=e,n.addClass("buildersidebar-"+e.position),a.children("li").children('a[href^="#"]').on("click",function(e){if(e.preventDefault(),"home"!==this.hash.slice(1)){var t=$(this).closest("li");t.hasClass("active")?n.close():t.hasClass("disabled")||n.open(this.hash.slice(1),t)}else i&&(n.hasClass("collapsed")?n.open(i):n.close())}),n.find(".buildersidebar-close").on("click",function(){n.close()}),n.open=function(e,t){void 0===t&&(t=a.find('li > a[href="#'+e+'"]').parent()),r.children(".buildersidebar-pane.active").removeClass("active"),r.children("#"+e).addClass("active"),a.children("li.active").removeClass("active"),t.addClass("active"),n.trigger("content",{id:e}),n.hasClass("collapsed")&&(n.trigger("opening"),n.removeClass("collapsed")),n.find("#builder-title-image").show(),i=e,n.options.onOpened(e)},n.close=function(){a.children("li.active").removeClass("active"),n.find("#builder-title-image").hide(),n.hasClass("collapsed")||(n.trigger("closing"),n.addClass("collapsed")),n.options.onClosed()},n}},{}],4:[function(e,t,n){(function(e){"use strict";function l(e){return function(){var l=e.apply(this,arguments);return new Promise(function(i,o){return function t(e,n){try{var a=l[e](n),r=a.value}catch(e){return void o(e)}if(!a.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});i(r)}("next")})}}var t,n,a,r,i,o,s,d;e.loadHtml=(t=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:$(".content-editor-pane-point").load("./window/point.html",null,function(){$(".content-editor-pane-line").load("./window/line.html",null,function(){$(".content-editor-pane-polygon").load("./window/polygon.html",null,function(){$(".content-editor-pane-basemap").load("./window/basemap.html",null,function(){$("#analysis .analysis-main").load("./window/analysis/main.html",null,function(){$("#settings").load("./window/setting.html",null,function(){$(".content-editor-pane-hand-draw").load("./window/hand_draw.html",null,function(){$("#hand-draw-edit-content").load("./window/hand_draw_edit.html",null,function(){t&&t()})})})})})})})});case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)}),e.initHtml=function(){KQ.Builder.BuilderUi.RenderSettingUi.getInstance().init(),$(".add-layer-tag").click(function(){"none"==$(".add-layer-list").css("display")&&($(".add-layer-list").css("display","block"),$(".add-layer-list").focus())}),$(".buildersiderbar-back").click(function(){$(".sidebar-content-panel").css("display","none"),$(".content-editor-pane").css("display","none"),$(".sidebar-layers-manager").css("display","block");var e=KQ.Builder.BuilderProject.getInstance(),t=e.setting.layer.getRender(),n=e.handDrawLayersContainer;t.dataSource=n.dataSource()}),window.loadFileDialog=null,$("#add-layer-list-item-file").on("mousedown",function(){var t,n;$(".add-layer-list").css("display","none"),window.loadFileDialog||(window.loadFileDialog=new KQ.Builder.BuilderUi.FileLoadDialog("#load-file-layer-container",{filter:"geojson"}),window.loadFileDialog.on("load",(n=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,KQ.Builder.BuilderCommon.addNewLayer(t.dataSourceInfo);case 2:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})),window.loadFileDialog.on("delete",function(e){$("#confirm-div").kendoConfirm({title:"删除远程图层文件",content:"远程图层文件删除后无法恢复，确定删除？",messages:{okText:"确定",cancelText:"取消"}}).data("kendoConfirm").result.done(function(){$("body").append($('<div id="confirm-div">')),window.loadFileDialog.fire("delete_event",e)}).fail(function(){$("body").append($('<div id="confirm-div">'))})}),window.loadFileDialog.on("delete_event",(t=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,deleteDataFile(t.dataSourceInfo.url);case 2:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)}))),$("#load-file-layer-container").data("kendoWindow").center().open()}),window.loadDataServiceDialog=null,$("#add-layer-list-item-database").on("mousedown",function(){var t;$(".add-layer-list").css("display","none"),window.loadDataServiceDialog||(window.loadDataServiceDialog=new KQ.Builder.BuilderUi.DataServiceLoadDialog("#load-database-layer-container",{filter:"geojson"}),window.loadDataServiceDialog.on("load",(t=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,KQ.Builder.BuilderCommon.addNewLayer(t.dataSourceInfo);case 2:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)}))),$("#load-database-layer-container").data("kendoWindow").center().open()}),window.webLayerLoadDialog=null;var t=KQ.Builder.BuilderProject.getInstance().mapView;$("#add-layer-list-item-web").on("mousedown",function(){$(".add-layer-list").css("display","none"),window.webLayerLoadDialog||(window.webLayerLoadDialog=new KQ.Builder.BuilderUi.WebLayerLoadDialog("#load-web-layer-container"),window.webLayerLoadDialog.on("confirm",function(e){KQ.Control.Waiting.show(t._getMap(),"pin","meter");try{console.log("dataSourceInfo",e.dataSourceInfo),KQ.Builder.BuilderCommon.addNewLayer(e.dataSourceInfo)}finally{KQ.Control.Waiting.close()}})),$("#load-web-layer-container").data("kendoWindow").center().open()}),$("#add-layer-list-item-hand-draw").on("mousedown",function(){$(".add-layer-list").css("display","none"),KQ.Control.Waiting.show(t._getMap(),"pin","meter");try{KQ.Builder.BuilderCommon.addNewLayer({name:"未命名注记图层",type:"HAND_DRAW_DATA"})}finally{KQ.Control.Waiting.close()}}),$(".add-layer-list").blur(function(){$(".add-layer-tag").css("focus"),$(".add-layer-list").css("display","none")})},e.loadProject=(n=l(regeneratorRuntime.mark(function e(t){var n,a,r,i,o,l,s,d,c,u,p,m,y,f,v,g,b,h,x;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,KQ.Common.NetworkTools.httpGetAsync(t);case 3:for(n=e.sent,a=JSON.parse(decodeURIComponent(n)),r=KQ.Builder.BuilderProject.getInstance(),i=KQ.Common.CommonTools.getUrlname(t),r.reloadConfig=a,o=KQ.Builder.BuilderProject.getInstance().reloadConfig,l=o.title,s=o.layers,KQ.Builder.BuilderCommon.clearLayersContainer(),d=[],c=0;c<s.length;++c)u=s[c][0],p=r.reloadConfig.layersOrderMap[u],d.splice(p,0,s[c][1]);m=KQ.Map.MapGeoman.getInstance(),o.geomanArray&&m.fromSaveString(o.geomanArray),y=KQ.Builder.BuilderProject.getInstance().mapView,KQ.Control.Waiting.show(y._getMap(),"pin","meter"),f=0;case 19:if(f<d.length)return v=d[f],g=v.featureType,b=v.options,h=v.dataSource,e.next=26,KQ.Builder.BuilderCommon.addNewLayerWithoutWaitingDialog(h);e.next=46;break;case 26:(x=e.sent).setRenderType(b.renderType,y),"hand-draw"===x.renderType&&x.getRender().setDataSource(v.renderDataSource),x.getRender().setOptions(b),x.renderType=b.renderType,window.builderInitDoms.refreshThematicColors(x,b),r.setting.layer=x,e.t0=g,e.next="point"===e.t0?37:"line"===e.t0?39:"polygon"===e.t0?41:43;break;case 37:return onPointLayerReady(),e.abrupt("break",43);case 39:return onLineLayerReady(),e.abrupt("break",43);case 41:return onPolygonLayerReady(),e.abrupt("break",43);case 43:f++,e.next=19;break;case 46:$("#current-project-name").text(l),KQ.Builder.ProjectManager.getInstance().taskId=i,y.setView([o.center.y,o.center.x],o.level),KQ.Control.Notification.getInstance().showSuccess("加载工程成功！"),e.next=56;break;case 53:e.prev=53,e.t1=e.catch(0),KQ.Control.Notification.getInstance().showError("加载失败，请检查网络！");case 56:return e.prev=56,KQ.Control.Waiting.close(),e.finish(56);case 59:case"end":return e.stop()}},e,this,[[0,53,56,59]])})),function(e){return n.apply(this,arguments)}),e.deleteDataFile=(a=l(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=KQ.Builder.BuilderProject.getInstance().mapView,KQ.Control.Waiting.show(n._getMap(),"pin","meter"),e.prev=2,e.next=5,deleteFile(t);case 5:if("success"===e.sent)return KQ.Control.Notification.getInstance().showSuccess("删除数据成功！"),e.next=10,window.loadFileDialog._refreshData();e.next=12;break;case 10:e.next=13;break;case 12:KQ.Control.Notification.getInstance().showError("删除数据失败！");case 13:return e.prev=13,KQ.Control.Waiting.close(),e.finish(13);case 16:case"end":return e.stop()}},e,this,[[2,,13,16]])})),function(e){return a.apply(this,arguments)}),e.deleteProjectFile=(r=l(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=KQ.Builder.BuilderProject.getInstance().mapView,KQ.Control.Waiting.show(n._getMap(),"pin","meter"),e.prev=2,e.next=5,deleteFile(t);case 5:if("success"===e.sent)return KQ.Control.Notification.getInstance().showSuccess("删除工程成功！"),e.next=10,window.loadProjectDialog._refreshData();e.next=12;break;case 10:e.next=13;break;case 12:KQ.Control.Notification.getInstance().showError("删除工程失败！");case 13:return e.prev=13,KQ.Control.Waiting.close(),e.finish(13);case 16:case"end":return e.stop()}},e,this,[[2,,13,16]])})),function(e){return r.apply(this,arguments)}),e.deleteFile=(i=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,KQ.Builder.BuilderCommon.isPortalEnvironment())return e.next=4,deleteFile_portal(t);e.next=7;break;case 4:return e.abrupt("return",e.sent);case 7:return e.next=9,deleteFile_server(t);case 9:return e.abrupt("return",e.sent);case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return","error");case 15:case"end":return e.stop()}},e,this,[[0,12]])})),function(e){return i.apply(this,arguments)}),e.deleteFile_server=(o=l(regeneratorRuntime.mark(function e(t){var n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.replace("/download/","/deleteFileById?taskIds="),e.t0=JSON,e.next=4,KQ.Common.NetworkTools.httpGetAsync(n);case 4:return e.t1=e.sent,a=e.t0.parse.call(e.t0,e.t1),e.abrupt("return",a.result);case 7:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)}),e.deleteFile_portal=(s=l(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.slice(t.lastIndexOf("/")+1),e.abrupt("return",parent.window.vm.$api.mapBuilderApi.deleteFileById({taskIds:n},{__LOGINTYPE:"dialog",noLoading:!0}).then(function(){var t=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.data.result);case 1:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}()).catch(function(){return"error"}));case 2:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)}),e.initLayersContainer=(d=l(regeneratorRuntime.mark(function e(o){var i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=KQ.Builder.BuilderProject.getInstance(),a=i.mapView,o=new KQ.Builder.BuilderUi.LayerListBox("vector-layers-container",{dataSource:[],dragend:function(e){var a=[],r=i.layersContainer;r.items().each(function(e,t){var n=r.dataItem(t);a.push({layerId:n.layerId,name:n.name,type:n.type})}),r.setDataSource(a),i.resetLayersZIndex()}}),i.layersContainer=o,$(".layers-container .base-layers li").click(function(){$(".sidebar-content-panel").css("display","block"),$(".sidebar-layers-manager").css("display","none"),$(".content-editor-pane-basemap").css("display","block")}),$("#vector-layers-container").bind("select",function(e,t){"tile"!=t.type&&(i.setting.name=t.name,i.setting.layer=t.layer,$(".sidebar-content-panel").css("display","block"),$(".sidebar-layers-manager").css("display","none"),$(".content-editor-pane-"+t.type).css("display","block"),$(".layer-editor-title-name").text(t.name),"point"==t.type?onPointLayerReady():"line"==t.type?onLineLayerReady():"polygon"==t.type?onPolygonLayerReady():"hand-draw"==t.type&&onHandDrawLayerReady())}),$("#vector-layers-container").bind("builder_layer_visible",function(e,t){var n=t.layer;n.visible=!0,n.getRender().addToMapView(a)}),$("#vector-layers-container").bind("builder_layer_invisible",function(e,t){var n=t.layer;n.visible=!1,n.getRender().remove()}),$("#vector-layers-container").bind("builder_full_map",function(e,t){t.layer.getRender().flyToBounds()}),$("#vector-layers-container").bind("builder_export",function(e,t){var n=t.layer,a=KQ.Builder.BuilderLayerDatas.getInstance().getData(n.options.guid),r=JSON.stringify(a);KQ.Common.CommonTools.exportData(r,"exportdata.geojson"),KQ.Control.Notification.getInstance().showSuccess(KQ.Local.Control.drawControl.exportDraw.success())}),$("#vector-layers-container").bind("builder_attribute_table",function(e,t){for(var n=t.layer,a=KQ.Builder.BuilderLayerDatas.getInstance().getData(n.options.guid),r=[],i=[],o=a.fields||Object.keys(a.features[0].properties),l=a.features,s=0;s<o.length;++s){var d=o[s].name||o[s],c=o[s].aliasName||d;r.push({field:d,title:c})}for(var u=0;u<l.length;++u)i.push(l[u].properties);KQ.Builder.BuilderUi.BuilderInfoDialog.getInstance().open(i,r)}),$("#vector-layers-container").bind("builder_legend",function(e,t,n){a.legend_window.open(),KQ.Builder.BuilderUi.ColorField.getInstance()._updateLegend()}),$("#vector-layers-container").bind("builder_layer_delete",function(e,t,n){o.remove(n),i.deleteLayer(t.layer),KQ.Builder.BuilderCommon.refreshAnalysisLayersControl()}),$("#vector-layers-container").bind("builder_rename",function(e,t,n){$(n).find(".secound-line .lists").css("display","none");var a=$(n).find(".first-line .title span"),r=$(n).find(".first-line .title input");a.css("display","none"),r.css("display","inline-block");var i=r.val();r.val("").focus().val(i),r.bind("click mousedown",function(e){e.stopPropagation()}),r.blur(function(e){a.css("display","inline-block"),r.css("display","none");var t=a.closest("li"),n=o._listbox.dataItem(t);n.set("name",r.val()),n.layer.options.dataSource.name=r.val()})}),$("#vector-layers-container").bind("builder_layer_attribute",function(e,t){for(var n=t.layer,a=KQ.Builder.BuilderLayerDatas.getInstance().getData(n.options.guid),r=[],i=["名称","显示名称","类型"],o=["name","aliasName","type"],l=0;l<o.length;++l)r.push({field:o[l],title:i[l]});for(var s=a.fields||Object.keys(a.features[0].properties),d=0;d<s.length;++d)s[d].aliasName=s[d].aliasName||s[d].name;KQ.Builder.BuilderUi.BuilderLayerAttributeDialog.getInstance().open(s,r)});case 15:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)}),e.initHandDrawLayersContainer=l(regeneratorRuntime.mark(function e(){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=new KQ.Builder.BuilderUi.HandDrawLayerListBox("hand-draw-list",{dataSource:[]}),KQ.Builder.BuilderProject.getInstance().handDrawLayersContainer=o,$("#hand-draw-list").bind("hand_draw_layer_rename",function(e,t,n){var a=$(n).find(".editable-span span"),r=$(n).find(".editable-span input");a.css("display","none"),r.css("display","inline-block");var i=r.val();r.val("").focus().val(i),r.blur(function(){a.css("display","inline-block"),r.css("display","none");var e=a.closest("li");o._listbox.dataItem(e).set("name",r.val())})}),$("#hand-draw-list").bind("hand_draw_layer_edit",function(e,t){var n=t.layer.editorOptions,a=n.imageInfo?100*n.imageInfo.radius:0,r=n.vectorInfo?100*n.vectorInfo.zoomRate:0,i=kendo.observable({styleOptions:n,radius:a,zoomRate:r,lineOpacity:100*n.lineOpacity,fillOpacity:100*n.fillOpacity,lineStyleList:KQ.Builder.BuilderUi.RenderSettingDataSource.lineStyleList()}),o=t.type;if("text"===o)KQ.Builder.BuilderUi.HandDrawTextEditDialog.getInstance().open({editorOptions:n}),KQ.Builder.BuilderProject.getInstance().setting.handDrawLayer=t.layer;else{"circle"!==o&&"rectangle"!==o||(o="polygon");var l=$("#tabstrip .hand-draw-edit-"+o);kendo.bind(l,i),KQ.Builder.BuilderProject.getInstance().setInfo("render_model",i),KQ.Builder.BuilderProject.getInstance().setting.handDrawLayer=t.layer,l.css("display","block").siblings().css("display","none"),KQ.Builder.BuilderUi.HandDrawEditDialog.getInstance().open(t),console.log("event",e,"dataItem",t),KQ.Builder.BuilderUi.HandDrawEdtInfo.getInstance().init(t),KQ.Builder.BuilderUi.HandDrawEditAttribute.getInstance().init(t)}}),$("#hand-draw-list").bind("hand_draw_layer_delete",function(e,t,n){KQ.Builder.BuilderProject.getInstance().geoman.removeGeomanLayer(t.layer),o.remove(n)});case 5:case"end":return e.stop()}},e,this)})),e.swapRenderType=function(e,t){var n=KQ.Builder.BuilderProject.getInstance(),a=n.mapView;n.setting.layer.setRenderType(e,a),n.setInfo("render_model",t.get(e)),KQ.Builder.BuilderUi.ColorField.getInstance()._updateLegend()},e.onPointLayerReady=function(){var e=KQ.Builder.BuilderProject.getInstance(),t=e.setting.layer;"vector"==t.render.get("basic").options.pointSymbolType?e.symbolTypeSwapButton.select(0):e.symbolTypeSwapButton.select(1);var n=t.render.get("basic").options;KQ.Builder.BuilderCommon.convertPointVectorInfoOptions(n);var a=kendo.observable({styleOptions:n,pointSize:n.vectorInfo.fontSize.split("px")[0],pointOpacity:100*n.vectorInfo.fillOpacity,lineOpacity:100*n.vectorInfo.strokeOpacity,labelDirectionList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelDirectionList(),labelFieldList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFieldList(),labelFontList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFontList()}),r=t.render.get("single").options;KQ.Builder.BuilderCommon.convertPointVectorInfoOptions(r);var i=kendo.observable({styleOptions:r,pointSize:r.vectorInfo.fontSize.split("px")[0],pointOpacity:100*r.vectorInfo.fillOpacity,lineOpacity:100*r.vectorInfo.strokeOpacity,thematicFieldList:KQ.Builder.BuilderUi.RenderSettingDataSource.thematicFieldList(),rampColorList:KQ.Builder.BuilderUi.RenderSettingDataSource.rampColorList(),labelDirectionList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelDirectionList(),labelFieldList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFieldList(),labelFontList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFontList()}),o=t.render.get("section").options;KQ.Builder.BuilderCommon.convertPointVectorInfoOptions(o);var l=kendo.observable({styleOptions:o,pointSize:o.vectorInfo.fontSize.split("px")[0],pointOpacity:100*o.vectorInfo.fillOpacity,lineOpacity:100*o.vectorInfo.strokeOpacity,thematicFieldList:KQ.Builder.BuilderUi.RenderSettingDataSource.thematicFieldList(),sectionMethodList:KQ.Builder.BuilderUi.RenderSettingDataSource.sectionMethodList(),sectionNumberList:KQ.Builder.BuilderUi.RenderSettingDataSource.sectionNumberList(),rampColorList:KQ.Builder.BuilderUi.RenderSettingDataSource.rampColorList(),lineStyleList:KQ.Builder.BuilderUi.RenderSettingDataSource.lineStyleList(),labelDirectionList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelDirectionList(),labelFieldList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFieldList(),labelFontList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFontList()}),s=t.render.get("heatmap").options,d=kendo.observable({styleOptions:s,weightFieldList:KQ.Builder.BuilderUi.RenderSettingDataSource.weightFieldList(),heatmapRampColorList:KQ.Builder.BuilderUi.RenderSettingDataSource.heatmapRampColorList()}),c=new Map([["basic",a],["single",i],["section",l],["heatmap",d]]);function u(){$("<style>.only-svg-symbol-tyle{display:block;}</style>").appendTo(document.body),e.getInfo("render_model").styleOptions.pointSymbolType="vector",KQ.Builder.BuilderCommon.fillSvgSymbols($(".symbols-box"),6),$(".symbols-container .symbols-box").trigger("symbol_type_vector")}function p(){$("<style>.only-svg-symbol-tyle{display:none;}</style>").appendTo(document.body),e.getInfo("render_model").styleOptions.pointSymbolType="image",KQ.Builder.BuilderCommon.fillImageSymbols($(".symbols-box"),10,6),$(".symbols-container .symbols-box").trigger("symbol_type_image")}c.forEach(function(e,t){kendo.bind($("div#point-theme-tools-"+t),e)}),KQ.Builder.BuilderUi.RenderSettingUi.getInstance().initColorField(),$(".point-layer-types .layer-type-img").removeClass("img-selected"),$(".point-layer-types .point-"+t.renderType).addClass("img-selected"),$(".point-theme-tools > .theme-tools-item").css("display","none"),$("#point-theme-tools-"+t.renderType).css("display","block"),$(".point-layer-types .layer-type-img").click(function(){if(!$(this).hasClass("img-selected")){$(".point-layer-types .layer-type-img").removeClass("img-selected"),$(this).addClass("img-selected"),$(".point-theme-tools > .theme-tools-item").css("display","none");var e=$(this).attr("type");$("#point-theme-tools-"+e).css("display","block"),swapRenderType(e,c)}}),swapRenderType(t.renderType,c),"vector"==n.pointSymbolType?u():p(),$(".point-symbol-svg").click(function(){u()}),$(".point-symbol-img").click(function(){p()})},e.onLineLayerReady=function(){var e=KQ.Builder.BuilderProject.getInstance().setting.layer,t=e.render.get("basic").options,n=kendo.observable({styleOptions:t,lineOpacity:100*t.lineOpacity,lineStyleList:KQ.Builder.BuilderUi.RenderSettingDataSource.lineStyleList(),labelFieldList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFieldList(),labelFontList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFontList()}),a=e.render.get("single").options,r=kendo.observable({styleOptions:a,lineOpacity:100*a.lineOpacity,thematicFieldList:KQ.Builder.BuilderUi.RenderSettingDataSource.thematicFieldList(),lineStyleList:KQ.Builder.BuilderUi.RenderSettingDataSource.lineStyleList(),rampColorList:KQ.Builder.BuilderUi.RenderSettingDataSource.rampColorList(),labelFieldList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFieldList(),labelFontList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFontList()}),i=e.render.get("section").options,o=kendo.observable({styleOptions:i,lineOpacity:100*i.lineOpacity,thematicFieldList:KQ.Builder.BuilderUi.RenderSettingDataSource.thematicFieldList(),sectionMethodList:KQ.Builder.BuilderUi.RenderSettingDataSource.sectionMethodList(),sectionNumberList:KQ.Builder.BuilderUi.RenderSettingDataSource.sectionNumberList(),lineStyleList:KQ.Builder.BuilderUi.RenderSettingDataSource.lineStyleList(),rampColorList:KQ.Builder.BuilderUi.RenderSettingDataSource.rampColorList(),labelFieldList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFieldList(),labelFontList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFontList()}),l=new Map([["basic",n],["single",r],["section",o]]);l.forEach(function(e,t){kendo.bind($("div#line-theme-tools-"+t),e)}),KQ.Builder.BuilderUi.RenderSettingUi.getInstance().initColorField(),$(".line-layer-types .layer-type-img").removeClass("img-selected"),$(".line-layer-types .line-"+e.renderType).addClass("img-selected"),$(".line-theme-tools > .theme-tools-item").css("display","none"),$("#line-theme-tools-"+e.renderType).css("display","block"),$(".line-layer-types .layer-type-img").click(function(){$(".line-layer-types .layer-type-img").removeClass("img-selected"),$(this).addClass("img-selected"),$(".line-theme-tools > .theme-tools-item").css("display","none");var e=$(this).attr("type");$("#line-theme-tools-"+e).css("display","block"),swapRenderType(e,l)}),swapRenderType(e.renderType,l)},e.onPolygonLayerReady=function(){var e=KQ.Builder.BuilderProject.getInstance().setting.layer,t=e.render.get("basic").options,n=kendo.observable({styleOptions:t,fillOpacity:100*t.fillOpacity,lineOpacity:100*t.lineOpacity,lineStyleList:KQ.Builder.BuilderUi.RenderSettingDataSource.lineStyleList(),labelFieldList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFieldList(),labelFontList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFontList()}),a=e.render.get("single").options,r=kendo.observable({styleOptions:a,fillOpacity:100*a.fillOpacity,lineOpacity:100*a.lineOpacity,thematicFieldList:KQ.Builder.BuilderUi.RenderSettingDataSource.thematicFieldList(),rampColorList:KQ.Builder.BuilderUi.RenderSettingDataSource.rampColorList(),lineStyleList:KQ.Builder.BuilderUi.RenderSettingDataSource.lineStyleList(),labelFieldList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFieldList(),labelFontList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFontList()}),i=e.render.get("section").options,o=kendo.observable({styleOptions:i,fillOpacity:100*i.fillOpacity,lineOpacity:100*i.lineOpacity,thematicFieldList:KQ.Builder.BuilderUi.RenderSettingDataSource.thematicFieldList(),sectionMethodList:KQ.Builder.BuilderUi.RenderSettingDataSource.sectionMethodList(),sectionNumberList:KQ.Builder.BuilderUi.RenderSettingDataSource.sectionNumberList(),rampColorList:KQ.Builder.BuilderUi.RenderSettingDataSource.rampColorList(),lineStyleList:KQ.Builder.BuilderUi.RenderSettingDataSource.lineStyleList(),labelFieldList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFieldList(),labelFontList:KQ.Builder.BuilderUi.RenderSettingDataSource.labelFontList()}),l=new Map([["basic",n],["single",r],["section",o]]);l.forEach(function(e,t){kendo.bind($("div#polygon-theme-tools-"+t),e)}),KQ.Builder.BuilderUi.RenderSettingUi.getInstance().initColorField(),$(".polygon-layer-types .layer-type-img").removeClass("img-selected"),$(".polygon-layer-types .region-"+e.renderType).addClass("img-selected"),$(".polygon-theme-tools > .theme-tools-item").css("display","none"),$("#polygon-theme-tools-"+e.renderType).css("display","block"),$(".polygon-layer-types .layer-type-img").click(function(){$(".polygon-layer-types .layer-type-img").removeClass("img-selected"),$(this).addClass("img-selected"),$(".polygon-theme-tools > .theme-tools-item").css("display","none");var e=$(this).attr("type");$("#polygon-theme-tools-"+e).css("display","block"),swapRenderType(e,l)}),swapRenderType(e.renderType,l)},e.onHandDrawLayerReady=function(){var e=KQ.Builder.BuilderProject.getInstance(),t=e.setting.layer.getRender(),n=e.handDrawLayersContainer,a=t.dataSource;n.reset(a)},e.initSiderbar=function(o){var e=new KQ.Control.Window("legend-window",{parentID:"KqMapID",position:{left:"355px",top:"10px"},icon:"fa fa-bar-chart",width:"240px",title:" 图例",draggable:!1,resizable:!1,scrollable:!1,close:function(e){}});e.initAsync(function(){o.legend_window=e}),jQuery.extend(jQuery.easing,{easeOutQuad:function(e,t,n,a,r){return-a*(t/=r)*(t-2)+n}});var t,n={onOpened:function(){$("#legend-window").parent().animate({left:"355px"},500,"easeOutQuad")},onClosed:function(){$("#legend-window").parent().animate({left:"63px"},500,"easeOutQuad")}},a=KQ.Builder.BuilderProject.getInstance(),r=$("#buildersidebar").buildersidebar(n);(a.siderbar=r).close(),$(".saveToolBar").kendoSaveToolBar({sidebar:r,onSelect:(t=l(regeneratorRuntime.mark(function e(t){var n,a,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=$(t.item).data("type"),console.log("Selected: "+n),e.t0=n,e.next="save"===e.t0?5:"saveas"===e.t0?23:"clouddown"===e.t0?27:"fold"===e.t0?31:34;break;case 5:return e.prev=5,KQ.Control.Waiting.show(o._getMap(),"pin","meter"),a=KQ.Builder.ProjectManager.getInstance(),r=$("#current-project-name")[0].innerText,(i={}).projectName=r,i.isSaveAs=!1,e.next=14,a.saveProject(i);case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(5),KQ.Control.Waiting.close();case 19:return e.prev=19,KQ.Control.Waiting.close(),e.finish(19);case 22:return e.abrupt("break",34);case 23:return window.ProjectSaveAsDialog=null,window.ProjectSaveAsDialog||(window.ProjectSaveAsDialog=new KQ.Builder.BuilderUi.ProjectSaveAsDialog("#project-saveas-container",{}),window.ProjectSaveAsDialog.on("save",function(){var t=l(regeneratorRuntime.mark(function e(t){var n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("save project: ",t),n=KQ.Builder.ProjectManager.getInstance(),(a={}).projectName=t.dataSourceInfo.name,a.isSaveAs=!0,e.next=7,n.saveProject(a);case 7:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}()),window.ProjectSaveAsDialog.on("cancal",function(){var t=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("cancel save: ",t);case 1:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}())),$("#project-saveas-container").data("kendoWindow").center().open(),e.abrupt("break",34);case 27:return window.loadProjectDialog=null,window.loadProjectDialog||(window.loadProjectDialog=new KQ.Builder.BuilderUi.ProjectLoadDialog("#project-download-container",{filter:"prj"}),window.loadProjectDialog.on("load",function(){var t=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,loadProject(t.dataSourceInfo.url);case 2:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}()),window.loadProjectDialog.on("delete",function(){var t=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:$("#confirm-div").kendoConfirm({title:"删除远程工程",content:"工程删除后无法恢复，确定删除？",messages:{okText:"确定",cancelText:"取消"}}).data("kendoConfirm").result.done(function(){$("body").append($('<div id="confirm-div">')),window.loadProjectDialog.fire("delete_event",t)}).fail(function(){$("body").append($('<div id="confirm-div">'))});case 1:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}()),window.loadProjectDialog.on("delete_event",function(){var t=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,deleteProjectFile(t.dataSourceInfo.url);case 2:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}())),$("#project-download-container").data("kendoWindow").center().open(),e.abrupt("break",34);case 31:return console.log("do fold1!"),this.options.sidebar&&this.options.sidebar.close(),e.abrupt("break",34);case 34:case"end":return e.stop()}},e,this,[[5,16,19,22]])})),function(e){return t.apply(this,arguments)})}),new KQ.Builder.BuilderUi.BuilderUserInfo},e.initMapGeoman=l(regeneratorRuntime.mark(function e(){var t,n,a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=KQ.Map.MapGeoman.getInstance(),a=KQ.Builder.BuilderProject.getInstance(),r=a.mapView._getMap(),n.init(t,r,{onCreate:function(e){var t=KQ.Builder.BuilderCommon.geomanShapeToType(e.shape);addHandDrawLayerItem(e.id,t),n.disableDraw(t)}}),a.geoman=n;case 6:case"end":return e.stop()}},e,this)}))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(e,t,n){"use strict";e("./builder/_initDoms"),e("./builder/libs/jquery-sidebar"),e("./builder/viewer"),e("./builder/common")},{"./builder/_initDoms":1,"./builder/common":2,"./builder/libs/jquery-sidebar":3,"./builder/viewer":4}]},{},[5]);