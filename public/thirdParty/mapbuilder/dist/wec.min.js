var t,e;window.flowEchartsIndex=0,t=function(i){return i.FlowEcharts=(i.version<"1.0"?i.Class:i.Layer).extend({includes:i.version<"1.0"?i.Mixin.Events:[],_echartsContainer:null,_map:null,_ec:null,_option:null,_echartsOption:null,initialize:function(t,e){this._option=e,this._echartsOption=t},onAdd:function(t){this._map=t,this._initEchartsContainer(),t.on("movestart",this._onMoveStart,this),t.on("moveend",this._redraw,this),this._redraw()},onRemove:function(t){this._echartsContainer&&t.getPanes().overlayPane.removeChild(this._echartsContainer),t.off("movestart",this._onMoveStart,this),t.off("moveend",this._redraw,this)},addTo:function(t){return t.addLayer(this),this},_initEchartsContainer:function(){this._echartsContainer&&this._map.getPanes().overlayPane.removeChild(this._echartsContainer);var t=this._map.getSize(),e=document.createElement("div");e.style.position="absolute",e.style.height=t.y+"px",e.style.width=t.x+"px",e.style.zIndex=flowEchartsIndex--,this._echartsContainer=e,this._map.getPanes().overlayPane.appendChild(this._echartsContainer)},_resetCanvasPosition:function(){var t=this._map.containerPointToLayerPoint([0,0]);i.DomUtil.setPosition(this._echartsContainer,t)},_redraw:function(){return this._resetCanvasPosition(),this._echartsContainer.style.opacity=1,this.initECharts(),this.setOption(this._echartsOption),this},_onMoveStart:function(){this._echartsContainer.style.opacity=.01},clear:function(){this._echartsContainer.innerHTML="",this.echartsOption={}},redraw:function(){this._redraw()},geoCoord2Pixel:function(t){var e=new i.latLng(t[1],t[0]),n=this._map.latLngToContainerPoint(e);return[n.x,n.y]},pixel2GeoCoord:function(t){var e=this._map.containerPointToLatLng(i.point(t[0],t[1]));return[e.lng,e.lat]},initECharts:function(){if(this._ec=echarts.init(this._echartsContainer),"3.0"<=echarts.version){var o=this;o._ec.Geo.prototype.dataToPoint=function(t){var e=new i.latLng(t[1],t[0]),n=o._map.latLngToContainerPoint(e);return[n.x,n.y]}}this._unbindEvent()},setOption:function(t,e){if(t.series){var n=t.series||{},o={},i=!1;if(echarts.version<"3.0"){for(var r=0;a=n[r++];){var s=a.geoCoord;s&&(i=!0,o=s)}var a;for(r=0;a=n[r++];){var h=a.markPoint||{},c=a.markLine||{},d=h.data;if(d&&d.length)for(var f=0,u=d.length;f<u;f++)i&&(d[f].geoCoord=o[d[f].name]),this._AddPos(d[f]);if((d=c.data)&&d.length)for(f=0,u=d.length;f<u;f++)i&&(d[f][0].geoCoord=o[d[f][0].name],d[f][1].geoCoord=o[d[f][1].name]),this._AddPos(d[f][0]),this._AddPos(d[f][1])}}this._ec.setOption(t,e)}},_AddPos:function(t){if(echarts.version<"3.0"){var e=echarts.version<"3.0"?t.geoCoord:t.coord,n=this.geoCoord2Pixel(e);t.x=n[0],t.y=n[1]}else{e=t.coord,n=this.geoCoord2Pixel(e);t.coord=n}},_unbindEvent:function(){echarts.version<"3.0"?(this._ec.getZrender().un("dragstart",function(){}),this._ec.getZrender().un("dragend",function(){}),this._ec.getZrender().un("mouseup",function(){}),this._ec.getZrender().un("mousedown",function(){}),this._ec.getZrender().un("mousewheel",function(){})):(this._ec.getZr().off("dragstart",function(){}),this._ec.getZr().off("dragend",function(){}),this._ec.getZr().off("mouseup",function(){}),this._ec.getZr().off("mousedown",function(){}),this._ec.getZr().off("mousewheel",function(){}))}}),i.flowEcharts=function(t,e){return new i.FlowEcharts(t,e)},i.flowEcharts},e=window,"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(module.exports=t(require("leaflet")),module.exports=t(require("jquery"))),void 0!==e&&e.L&&(e.L.flowEcharts=t(L));